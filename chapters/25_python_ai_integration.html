<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python Jumpstart: Coding Fundamentals for the AI Era - 26&nbsp; Python AI Integration: Connecting Your Code to Intelligent Services</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/26_ai_assistance_tips.html" rel="next">
<link href="../chapters/24_ai_programming_assistants.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/24_ai_programming_assistants.html">Python in the AI Era</a></li><li class="breadcrumb-item"><a href="../chapters/25_python_ai_integration.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">AI Integrator: Connecting Python Applications to AI Services</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Python Jumpstart: Coding Fundamentals for the AI Era</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/michael-borck/python-jumpstart" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="../Python-Jumpstart--Coding-Fundamentals-for-the-AI-Era.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="../Python-Jumpstart--Coding-Fundamentals-for-the-AI-Era.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Jumpstart: Coding Fundamentals for the AI Era</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Core Python Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01_python_in_the_age_of_ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python in the Age of AI: Coding with Digital Collaborators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02_basic_python_syntax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Python Language Syntax: Your Coding Roadmap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Values: The Building Blocks of Python Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Variables: Your Data’s Home in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05_output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Output Odyssey: Making Your Code Speak to the World</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06_input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Input Inception: Getting Data from Users into Your Programs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07_operators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Operator’s Manual: Mastering Python’s Mathematical and Logical Tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Functions and Control Flow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08_using_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Function Fiesta: Using Python’s Pre-built Code Blocks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09_creating_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Function Factory: Crafting Your Own Reusable Code Magic</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10_making_decisions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Decision Director: Guiding Your Program’s Path with If Statements</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data Structures and Iteration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11_lists.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">List Laboratory: Organizing Data in Python’s Most Versatile Container</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12_going_loopy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Going Loopy: Repeating Code Without Losing Your Mind</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13_strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">String Theory: Manipulating Text in the Python Universe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14_dictionaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Dictionary Detectives: Mastering Python’s Key-Value Pairs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Working with Data and Files</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">File Frontier: Reading and Writing Data to Permanent Storage</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Code Quality and Organization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/16_errors_and_exceptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error Embassy: Understanding and Handling Exceptions with Grace</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/17_debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Debugging Detectives: Finding and Fixing Code Mysteries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/18_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Test Kitchen: Ensuring Your Code Works as Intended</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/19_modules_and_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Module Mastery: Organizing Your Code for Growth and Reuse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/20_orientating_your_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Orientating Your Objects: Building Digital Models of Real-World Things</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Practical Python Usage</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/21_how_to_run_python_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Python Pilot: How to Execute Your Code in Different Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/22_how_to_install_python_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Installation Station: Setting Up Python and Required Libraries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/23_getting_help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Help Headquarters: Finding Answers When You Get Stuck</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Python in the AI Era</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/24_ai_programming_assistants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">AI Programming Assistants: Coding with Digital Colleagues</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/25_python_ai_integration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">AI Integrator: Connecting Python Applications to AI Services</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/26_ai_assistance_tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">AI Assistance Tips: Maximizing Your Machine Learning Mentors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/27_intentional_prompting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Intentional Prompting: Speaking the Language of AI Assistants</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Project: Build Your Own AI Chatbot</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/chatbot_project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Chatbot Construction Site: Building Your AI-Enhanced Python Conversation Partner</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-25-python-ai-integration" id="toc-chapter-25-python-ai-integration" class="nav-link active" data-scroll-target="#chapter-25-python-ai-integration"><span class="header-section-number">27</span> Chapter 25: Python AI Integration</a>
  <ul class="collapse">
  <li><a href="#chapter-outline" id="toc-chapter-outline" class="nav-link" data-scroll-target="#chapter-outline"><span class="header-section-number">27.1</span> Chapter Outline</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">27.2</span> Learning Objectives</a></li>
  <li><a href="#introduction-connecting-python-to-ai-capabilities" id="toc-introduction-connecting-python-to-ai-capabilities" class="nav-link" data-scroll-target="#introduction-connecting-python-to-ai-capabilities"><span class="header-section-number">27.3</span> 1. Introduction: Connecting Python to AI Capabilities</a></li>
  <li><a href="#the-ai-integration-landscape" id="toc-the-ai-integration-landscape" class="nav-link" data-scroll-target="#the-ai-integration-landscape"><span class="header-section-number">27.4</span> 2. The AI Integration Landscape</a>
  <ul class="collapse">
  <li><a href="#types-of-ai-services" id="toc-types-of-ai-services" class="nav-link" data-scroll-target="#types-of-ai-services"><span class="header-section-number">27.4.1</span> Types of AI Services</a></li>
  <li><a href="#integration-models" id="toc-integration-models" class="nav-link" data-scroll-target="#integration-models"><span class="header-section-number">27.4.2</span> Integration Models</a></li>
  </ul></li>
  <li><a href="#getting-started-with-ai-api-integration" id="toc-getting-started-with-ai-api-integration" class="nav-link" data-scroll-target="#getting-started-with-ai-api-integration"><span class="header-section-number">27.5</span> 3. Getting Started with AI API Integration</a>
  <ul class="collapse">
  <li><a href="#basic-api-integration-pattern" id="toc-basic-api-integration-pattern" class="nav-link" data-scroll-target="#basic-api-integration-pattern"><span class="header-section-number">27.5.1</span> Basic API Integration Pattern</a></li>
  <li><a href="#example-text-generation-with-openai" id="toc-example-text-generation-with-openai" class="nav-link" data-scroll-target="#example-text-generation-with-openai"><span class="header-section-number">27.5.2</span> Example: Text Generation with OpenAI</a></li>
  <li><a href="#example-image-analysis-with-azure-computer-vision" id="toc-example-image-analysis-with-azure-computer-vision" class="nav-link" data-scroll-target="#example-image-analysis-with-azure-computer-vision"><span class="header-section-number">27.5.3</span> Example: Image Analysis with Azure Computer Vision</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-25-python-ai-integration-1" id="toc-chapter-25-python-ai-integration-1" class="nav-link" data-scroll-target="#chapter-25-python-ai-integration-1"><span class="header-section-number">28</span> Chapter 25: Python AI Integration</a>
  <ul class="collapse">
  <li><a href="#chapter-outline-1" id="toc-chapter-outline-1" class="nav-link" data-scroll-target="#chapter-outline-1"><span class="header-section-number">28.1</span> Chapter Outline</a></li>
  <li><a href="#learning-objectives-1" id="toc-learning-objectives-1" class="nav-link" data-scroll-target="#learning-objectives-1"><span class="header-section-number">28.2</span> Learning Objectives</a></li>
  <li><a href="#introduction-connecting-python-to-ai-capabilities-1" id="toc-introduction-connecting-python-to-ai-capabilities-1" class="nav-link" data-scroll-target="#introduction-connecting-python-to-ai-capabilities-1"><span class="header-section-number">28.3</span> 1. Introduction: Connecting Python to AI Capabilities</a></li>
  <li><a href="#the-ai-integration-landscape-1" id="toc-the-ai-integration-landscape-1" class="nav-link" data-scroll-target="#the-ai-integration-landscape-1"><span class="header-section-number">28.4</span> 2. The AI Integration Landscape</a>
  <ul class="collapse">
  <li><a href="#types-of-ai-services-1" id="toc-types-of-ai-services-1" class="nav-link" data-scroll-target="#types-of-ai-services-1"><span class="header-section-number">28.4.1</span> Types of AI Services</a></li>
  <li><a href="#integration-models-1" id="toc-integration-models-1" class="nav-link" data-scroll-target="#integration-models-1"><span class="header-section-number">28.4.2</span> Integration Models</a></li>
  </ul></li>
  <li><a href="#getting-started-with-ai-api-integration-1" id="toc-getting-started-with-ai-api-integration-1" class="nav-link" data-scroll-target="#getting-started-with-ai-api-integration-1"><span class="header-section-number">28.5</span> 3. Getting Started with AI API Integration</a>
  <ul class="collapse">
  <li><a href="#basic-api-integration-pattern-1" id="toc-basic-api-integration-pattern-1" class="nav-link" data-scroll-target="#basic-api-integration-pattern-1"><span class="header-section-number">28.5.1</span> Basic API Integration Pattern</a></li>
  <li><a href="#example-text-generation-with-openai-1" id="toc-example-text-generation-with-openai-1" class="nav-link" data-scroll-target="#example-text-generation-with-openai-1"><span class="header-section-number">28.5.2</span> Example: Text Generation with OpenAI</a></li>
  <li><a href="#example-image-analysis-with-azure-computer-vision-1" id="toc-example-image-analysis-with-azure-computer-vision-1" class="nav-link" data-scroll-target="#example-image-analysis-with-azure-computer-vision-1"><span class="header-section-number">28.5.3</span> Example: Image Analysis with Azure Computer Vision</a></li>
  </ul></li>
  <li><a href="#secure-authentication-and-api-key-management" id="toc-secure-authentication-and-api-key-management" class="nav-link" data-scroll-target="#secure-authentication-and-api-key-management"><span class="header-section-number">28.6</span> 7. Secure Authentication and API Key Management</a>
  <ul class="collapse">
  <li><a href="#using-environment-variables" id="toc-using-environment-variables" class="nav-link" data-scroll-target="#using-environment-variables"><span class="header-section-number">28.6.1</span> Using Environment Variables</a></li>
  <li><a href="#secure-key-storage-options" id="toc-secure-key-storage-options" class="nav-link" data-scroll-target="#secure-key-storage-options"><span class="header-section-number">28.6.2</span> Secure Key Storage Options</a></li>
  </ul></li>
  <li><a href="#testing-and-troubleshooting-ai-integrations" id="toc-testing-and-troubleshooting-ai-integrations" class="nav-link" data-scroll-target="#testing-and-troubleshooting-ai-integrations"><span class="header-section-number">28.7</span> 8. Testing and Troubleshooting AI Integrations</a>
  <ul class="collapse">
  <li><a href="#creating-test-fixtures-for-ai-apis" id="toc-creating-test-fixtures-for-ai-apis" class="nav-link" data-scroll-target="#creating-test-fixtures-for-ai-apis"><span class="header-section-number">28.7.1</span> Creating Test Fixtures for AI APIs</a></li>
  <li><a href="#creating-a-test-mode-for-ai-dependent-features" id="toc-creating-a-test-mode-for-ai-dependent-features" class="nav-link" data-scroll-target="#creating-a-test-mode-for-ai-dependent-features"><span class="header-section-number">28.7.2</span> Creating a Test Mode for AI-Dependent Features</a></li>
  </ul></li>
  <li><a href="#project-corner-enhancing-your-chatbot-with-ai" id="toc-project-corner-enhancing-your-chatbot-with-ai" class="nav-link" data-scroll-target="#project-corner-enhancing-your-chatbot-with-ai"><span class="header-section-number">28.8</span> 9. Project Corner: Enhancing Your Chatbot with AI</a>
  <ul class="collapse">
  <li><a href="#adding-ai-powered-understanding-to-the-chatbot" id="toc-adding-ai-powered-understanding-to-the-chatbot" class="nav-link" data-scroll-target="#adding-ai-powered-understanding-to-the-chatbot"><span class="header-section-number">28.8.1</span> Adding AI-Powered Understanding to the Chatbot</a></li>
  <li><a href="#ai-enhanced-chatbot-implementation" id="toc-ai-enhanced-chatbot-implementation" class="nav-link" data-scroll-target="#ai-enhanced-chatbot-implementation"><span class="header-section-number">28.8.2</span> AI-Enhanced Chatbot Implementation</a></li>
  <li><a href="#running-the-ai-enhanced-chatbot" id="toc-running-the-ai-enhanced-chatbot" class="nav-link" data-scroll-target="#running-the-ai-enhanced-chatbot"><span class="header-section-number">28.8.3</span> Running the AI-Enhanced Chatbot</a></li>
  </ul></li>
  <li><a href="#handling-api-costs-and-rate-limits" id="toc-handling-api-costs-and-rate-limits" class="nav-link" data-scroll-target="#handling-api-costs-and-rate-limits"><span class="header-section-number">28.9</span> 10. Handling API Costs and Rate Limits</a></li>
  <li><a href="#cross-references" id="toc-cross-references" class="nav-link" data-scroll-target="#cross-references"><span class="header-section-number">28.10</span> Cross-References</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">28.11</span> Summary</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/michael-borck/python-jumpstart/edit/main/chapters/25_python_ai_integration.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/michael-borck/python-jumpstart/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">AI Integrator: Connecting Python Applications to AI Services</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="chapter-25-python-ai-integration" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> Chapter 25: Python AI Integration</h1>
<section id="chapter-outline" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="chapter-outline"><span class="header-section-number">27.1</span> Chapter Outline</h2>
<ul>
<li>Understanding the AI integration landscape for Python</li>
<li>Working with AI APIs and services</li>
<li>Using popular Python libraries for AI integration</li>
<li>Building text and image processing capabilities</li>
<li>Implementing conversational AI in Python applications</li>
<li>Handling API authentication and usage limits</li>
<li>Testing and troubleshooting AI integrations</li>
<li>Enhancing your chatbot with external AI capabilities</li>
</ul>
</section>
<section id="learning-objectives" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">27.2</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to: - Understand the ecosystem of AI services available for Python integration - Connect to AI APIs using Python’s requests library - Implement basic text analysis using natural language processing (NLP) services - Use Python to access image recognition and generation capabilities - Add conversational AI features to Python applications - Handle authentication and API key management securely - Test and troubleshoot common AI integration issues - Enhance your chatbot with external AI capabilities</p>
</section>
<section id="introduction-connecting-python-to-ai-capabilities" class="level2" data-number="27.3">
<h2 data-number="27.3" class="anchored" data-anchor-id="introduction-connecting-python-to-ai-capabilities"><span class="header-section-number">27.3</span> 1. Introduction: Connecting Python to AI Capabilities</h2>
<p>While Python itself is a powerful programming language, it becomes even more powerful when connected to external AI services. Modern AI capabilities like natural language understanding, image recognition, and text generation are now accessible through simple API calls, allowing Python developers to create increasingly intelligent applications without needing to train their own AI models.</p>
<p>This chapter explores how to integrate these AI capabilities into your Python applications. We’ll focus on practical integration patterns rather than the theory behind AI models, giving you the tools to enhance your projects with AI features regardless of your background in machine learning.</p>
<p>The skills you’ll learn in this chapter represent a significant trend in modern programming: the ability to compose applications by connecting to specialized AI services rather than building everything from scratch. This approach lets you leverage cutting-edge AI research in your projects without requiring expertise in data science or machine learning.</p>
<p><strong><em>AI Tip: When integrating AI services into your Python applications, always start with a minimal proof-of-concept to test the API connection and response format before building more complex features. This helps identify integration issues early and ensures you understand the service’s capabilities and limitations.</em></strong></p>
</section>
<section id="the-ai-integration-landscape" class="level2" data-number="27.4">
<h2 data-number="27.4" class="anchored" data-anchor-id="the-ai-integration-landscape"><span class="header-section-number">27.4</span> 2. The AI Integration Landscape</h2>
<p>The AI services landscape offers a variety of options for Python developers, ranging from general-purpose AI platforms to specialized services for specific tasks.</p>
<section id="types-of-ai-services" class="level3" data-number="27.4.1">
<h3 data-number="27.4.1" class="anchored" data-anchor-id="types-of-ai-services"><span class="header-section-number">27.4.1</span> Types of AI Services</h3>
<ol type="1">
<li><strong>Large Language Models (LLMs)</strong>
<ul>
<li>Services like OpenAI’s GPT models, Anthropic’s Claude, or Google’s Gemini</li>
<li>Capabilities include text generation, summarization, translation, and question answering</li>
<li>Access through REST APIs with API key authentication</li>
</ul></li>
<li><strong>Vision AI Services</strong>
<ul>
<li>Image classification, object detection, OCR (Optical Character Recognition)</li>
<li>Available through Google Cloud Vision, Azure Computer Vision, AWS Rekognition</li>
<li>Typically requires sending image data and receiving structured analysis</li>
</ul></li>
<li><strong>Speech and Audio Services</strong>
<ul>
<li>Speech-to-text, text-to-speech, audio analysis</li>
<li>Google Cloud Speech, Amazon Transcribe, Azure Speech Services</li>
<li>Often involves streaming audio or uploading audio files</li>
</ul></li>
<li><strong>Specialized NLP Services</strong>
<ul>
<li>Sentiment analysis, named entity recognition, language detection</li>
<li>Available through various providers or as standalone APIs</li>
<li>Usually takes text input and returns structured analysis</li>
</ul></li>
<li><strong>Multi-modal Services</strong>
<ul>
<li>Combining text, image, audio in a single API</li>
<li>Examples include OpenAI’s GPT-4 Vision, Google’s Gemini, Anthropic’s Claude Opus</li>
<li>Allows for more complex interactions like “describe this image” or “create an image based on this text”</li>
</ul></li>
</ol>
</section>
<section id="integration-models" class="level3" data-number="27.4.2">
<h3 data-number="27.4.2" class="anchored" data-anchor-id="integration-models"><span class="header-section-number">27.4.2</span> Integration Models</h3>
<p>When integrating AI services, you’ll generally use one of these patterns:</p>
<ol type="1">
<li><strong>REST API Integration</strong>
<ul>
<li>Making HTTP requests to AI service endpoints</li>
<li>Sending data in JSON format and processing JSON responses</li>
<li>Managing authentication through API keys or OAuth tokens</li>
</ul></li>
<li><strong>SDK-based Integration</strong>
<ul>
<li>Using official Python libraries provided by AI service vendors</li>
<li>Typically wraps the REST API with Python-friendly interfaces</li>
<li>Often handles authentication and request formatting</li>
</ul></li>
<li><strong>Library-based Integration</strong>
<ul>
<li>Using third-party Python libraries that abstract away the API details</li>
<li>May provide higher-level functionality or combine multiple services</li>
<li>Examples include LangChain, LlamaIndex, and similar frameworks</li>
</ul></li>
<li><strong>Self-hosted Models</strong>
<ul>
<li>Running open-source AI models directly in your application</li>
<li>Libraries like Hugging Face’s Transformers make this possible</li>
<li>Requires more computational resources but reduces API costs and latency</li>
</ul></li>
</ol>
</section>
</section>
<section id="getting-started-with-ai-api-integration" class="level2" data-number="27.5">
<h2 data-number="27.5" class="anchored" data-anchor-id="getting-started-with-ai-api-integration"><span class="header-section-number">27.5</span> 3. Getting Started with AI API Integration</h2>
<p>Let’s start with the most common integration pattern: connecting to an AI service via REST API.</p>
<section id="basic-api-integration-pattern" class="level3" data-number="27.5.1">
<h3 data-number="27.5.1" class="anchored" data-anchor-id="basic-api-integration-pattern"><span class="header-section-number">27.5.1</span> Basic API Integration Pattern</h3>
<p>Most AI API integrations follow a similar pattern:</p>
<ol type="1">
<li>Sign up for the service and obtain API credentials</li>
<li>Install the necessary Python packages (<code>requests</code> at minimum)</li>
<li>Prepare your data for the API request</li>
<li>Make the API call</li>
<li>Process and use the response</li>
</ol>
</section>
<section id="example-text-generation-with-openai" class="level3" data-number="27.5.2">
<h3 data-number="27.5.2" class="anchored" data-anchor-id="example-text-generation-with-openai"><span class="header-section-number">27.5.2</span> Example: Text Generation with OpenAI</h3>
<p>Here’s a basic example of integrating with OpenAI’s API:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_text(prompt, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate text using OpenAI's API.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">        prompt (str): The text prompt to send to the API</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): OpenAI API key. If None, uses environment variable.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The generated text response</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment variable if not provided</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as OPENAI_API_KEY environment variable"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API endpoint</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.openai.com/v1/chat/completions"</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare the request payload</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: <span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"messages"</span>: [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature"</span>: <span class="fl">0.7</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_tokens"</span>: <span class="dv">150</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare headers with authentication</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"Bearer </span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the API request</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>json.dumps(payload))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()  <span class="co"># Raise exception for HTTP errors</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the response</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        response_data <span class="op">=</span> response.json()</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the generated text</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        generated_text <span class="op">=</span> response_data[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generated_text.strip()</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling OpenAI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-image-analysis-with-azure-computer-vision" class="level3" data-number="27.5.3">
<h3 data-number="27.5.3" class="anchored" data-anchor-id="example-image-analysis-with-azure-computer-vision"><span class="header-section-number">27.5.3</span> Example: Image Analysis with Azure Computer Vision</h3>
<p>Here’s how you might integrate with Microsoft Azure’s Computer Vision service:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_image(image_url, api_key<span class="op">=</span><span class="va">None</span>, endpoint<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze an image using Azure Computer Vision API.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">        image_url (str): URL of the image to analyze</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): Azure API key. If None, uses environment variable.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint (str, optional): Azure endpoint. If None, uses environment variable.</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The analysis results</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get credentials from environment variables if not provided</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_API_KEY"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as AZURE_VISION_API_KEY environment variable"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        endpoint <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_ENDPOINT"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Endpoint must be provided or set as AZURE_VISION_ENDPOINT environment variable"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API URL</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    vision_url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">/vision/v3.2/analyze"</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"visualFeatures"</span>: <span class="st">"Categories,Description,Objects"</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"language"</span>: <span class="st">"en"</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Headers</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ocp-Apim-Subscription-Key"</span>: api_key</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Request body</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> {</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"url"</span>: image_url</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the request</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(vision_url, headers<span class="op">=</span>headers, params<span class="op">=</span>params, json<span class="op">=</span>body)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the analysis results</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling Azure Vision API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="chapter-25-python-ai-integration-1" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> Chapter 25: Python AI Integration</h1>
<section id="chapter-outline-1" class="level2" data-number="28.1">
<h2 data-number="28.1" class="anchored" data-anchor-id="chapter-outline-1"><span class="header-section-number">28.1</span> Chapter Outline</h2>
<ul>
<li>Understanding the AI integration landscape for Python</li>
<li>Working with AI APIs and services</li>
<li>Using popular Python libraries for AI integration</li>
<li>Building text and image processing capabilities</li>
<li>Implementing conversational AI in Python applications</li>
<li>Handling API authentication and usage limits</li>
<li>Testing and troubleshooting AI integrations</li>
<li>Enhancing your chatbot with external AI capabilities</li>
</ul>
</section>
<section id="learning-objectives-1" class="level2" data-number="28.2">
<h2 data-number="28.2" class="anchored" data-anchor-id="learning-objectives-1"><span class="header-section-number">28.2</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to: - Understand the ecosystem of AI services available for Python integration - Connect to AI APIs using Python’s requests library - Implement basic text analysis using natural language processing (NLP) services - Use Python to access image recognition and generation capabilities - Add conversational AI features to Python applications - Handle authentication and API key management securely - Test and troubleshoot common AI integration issues - Enhance your chatbot with external AI capabilities</p>
</section>
<section id="introduction-connecting-python-to-ai-capabilities-1" class="level2" data-number="28.3">
<h2 data-number="28.3" class="anchored" data-anchor-id="introduction-connecting-python-to-ai-capabilities-1"><span class="header-section-number">28.3</span> 1. Introduction: Connecting Python to AI Capabilities</h2>
<p>While Python itself is a powerful programming language, it becomes even more powerful when connected to external AI services. Modern AI capabilities like natural language understanding, image recognition, and text generation are now accessible through simple API calls, allowing Python developers to create increasingly intelligent applications without needing to train their own AI models.</p>
<p>This chapter explores how to integrate these AI capabilities into your Python applications. We’ll focus on practical integration patterns rather than the theory behind AI models, giving you the tools to enhance your projects with AI features regardless of your background in machine learning.</p>
<p>The skills you’ll learn in this chapter represent a significant trend in modern programming: the ability to compose applications by connecting to specialized AI services rather than building everything from scratch. This approach lets you leverage cutting-edge AI research in your projects without requiring expertise in data science or machine learning.</p>
<p><strong><em>AI Tip: When integrating AI services into your Python applications, always start with a minimal proof-of-concept to test the API connection and response format before building more complex features. This helps identify integration issues early and ensures you understand the service’s capabilities and limitations.</em></strong></p>
</section>
<section id="the-ai-integration-landscape-1" class="level2" data-number="28.4">
<h2 data-number="28.4" class="anchored" data-anchor-id="the-ai-integration-landscape-1"><span class="header-section-number">28.4</span> 2. The AI Integration Landscape</h2>
<p>The AI services landscape offers a variety of options for Python developers, ranging from general-purpose AI platforms to specialized services for specific tasks.</p>
<section id="types-of-ai-services-1" class="level3" data-number="28.4.1">
<h3 data-number="28.4.1" class="anchored" data-anchor-id="types-of-ai-services-1"><span class="header-section-number">28.4.1</span> Types of AI Services</h3>
<ol type="1">
<li><strong>Large Language Models (LLMs)</strong>
<ul>
<li>Services like OpenAI’s GPT models, Anthropic’s Claude, or Google’s Gemini</li>
<li>Capabilities include text generation, summarization, translation, and question answering</li>
<li>Access through REST APIs with API key authentication</li>
</ul></li>
<li><strong>Vision AI Services</strong>
<ul>
<li>Image classification, object detection, OCR (Optical Character Recognition)</li>
<li>Available through Google Cloud Vision, Azure Computer Vision, AWS Rekognition</li>
<li>Typically requires sending image data and receiving structured analysis</li>
</ul></li>
<li><strong>Speech and Audio Services</strong>
<ul>
<li>Speech-to-text, text-to-speech, audio analysis</li>
<li>Google Cloud Speech, Amazon Transcribe, Azure Speech Services</li>
<li>Often involves streaming audio or uploading audio files</li>
</ul></li>
<li><strong>Specialized NLP Services</strong>
<ul>
<li>Sentiment analysis, named entity recognition, language detection</li>
<li>Available through various providers or as standalone APIs</li>
<li>Usually takes text input and returns structured analysis</li>
</ul></li>
<li><strong>Multi-modal Services</strong>
<ul>
<li>Combining text, image, audio in a single API</li>
<li>Examples include OpenAI’s GPT-4 Vision, Google’s Gemini, Anthropic’s Claude Opus</li>
<li>Allows for more complex interactions like “describe this image” or “create an image based on this text”</li>
</ul></li>
</ol>
</section>
<section id="integration-models-1" class="level3" data-number="28.4.2">
<h3 data-number="28.4.2" class="anchored" data-anchor-id="integration-models-1"><span class="header-section-number">28.4.2</span> Integration Models</h3>
<p>When integrating AI services, you’ll generally use one of these patterns:</p>
<ol type="1">
<li><strong>REST API Integration</strong>
<ul>
<li>Making HTTP requests to AI service endpoints</li>
<li>Sending data in JSON format and processing JSON responses</li>
<li>Managing authentication through API keys or OAuth tokens</li>
</ul></li>
<li><strong>SDK-based Integration</strong>
<ul>
<li>Using official Python libraries provided by AI service vendors</li>
<li>Typically wraps the REST API with Python-friendly interfaces</li>
<li>Often handles authentication and request formatting</li>
</ul></li>
<li><strong>Library-based Integration</strong>
<ul>
<li>Using third-party Python libraries that abstract away the API details</li>
<li>May provide higher-level functionality or combine multiple services</li>
<li>Examples include LangChain, LlamaIndex, and similar frameworks</li>
</ul></li>
<li><strong>Self-hosted Models</strong>
<ul>
<li>Running open-source AI models directly in your application</li>
<li>Libraries like Hugging Face’s Transformers make this possible</li>
<li>Requires more computational resources but reduces API costs and latency</li>
</ul></li>
</ol>
</section>
</section>
<section id="getting-started-with-ai-api-integration-1" class="level2" data-number="28.5">
<h2 data-number="28.5" class="anchored" data-anchor-id="getting-started-with-ai-api-integration-1"><span class="header-section-number">28.5</span> 3. Getting Started with AI API Integration</h2>
<p>Let’s start with the most common integration pattern: connecting to an AI service via REST API.</p>
<section id="basic-api-integration-pattern-1" class="level3" data-number="28.5.1">
<h3 data-number="28.5.1" class="anchored" data-anchor-id="basic-api-integration-pattern-1"><span class="header-section-number">28.5.1</span> Basic API Integration Pattern</h3>
<p>Most AI API integrations follow a similar pattern:</p>
<ol type="1">
<li>Sign up for the service and obtain API credentials</li>
<li>Install the necessary Python packages (<code>requests</code> at minimum)</li>
<li>Prepare your data for the API request</li>
<li>Make the API call</li>
<li>Process and use the response</li>
</ol>
</section>
<section id="example-text-generation-with-openai-1" class="level3" data-number="28.5.2">
<h3 data-number="28.5.2" class="anchored" data-anchor-id="example-text-generation-with-openai-1"><span class="header-section-number">28.5.2</span> Example: Text Generation with OpenAI</h3>
<p>Here’s a basic example of integrating with OpenAI’s API:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_text(prompt, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate text using OpenAI's API.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">        prompt (str): The text prompt to send to the API</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): OpenAI API key. If None, uses environment variable.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The generated text response</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment variable if not provided</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as OPENAI_API_KEY environment variable"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API endpoint</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.openai.com/v1/chat/completions"</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare the request payload</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: <span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"messages"</span>: [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature"</span>: <span class="fl">0.7</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_tokens"</span>: <span class="dv">150</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare headers with authentication</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"Bearer </span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the API request</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>json.dumps(payload))</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()  <span class="co"># Raise exception for HTTP errors</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the response</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        response_data <span class="op">=</span> response.json()</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the generated text</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        generated_text <span class="op">=</span> response_data[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generated_text.strip()</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling OpenAI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-image-analysis-with-azure-computer-vision-1" class="level3" data-number="28.5.3">
<h3 data-number="28.5.3" class="anchored" data-anchor-id="example-image-analysis-with-azure-computer-vision-1"><span class="header-section-number">28.5.3</span> Example: Image Analysis with Azure Computer Vision</h3>
<p>Here’s how you might integrate with Microsoft Azure’s Computer Vision service:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_image(image_url, api_key<span class="op">=</span><span class="va">None</span>, endpoint<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze an image using Azure Computer Vision API.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">        image_url (str): URL of the image to analyze</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): Azure API key. If None, uses environment variable.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint (str, optional): Azure endpoint. If None, uses environment variable.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The analysis results</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get credentials from environment variables if not provided</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_API_KEY"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as AZURE_VISION_API_KEY environment variable"</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        endpoint <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_ENDPOINT"</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Endpoint must be provided or set as AZURE_VISION_ENDPOINT environment variable"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API URL</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    vision_url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">/vision/v3.2/analyze"</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"visualFeatures"</span>: <span class="st">"Categories,Description,Objects"</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"language"</span>: <span class="st">"en"</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Headers</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ocp-Apim-Subscription-Key"</span>: api_key</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Request body</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> {</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"url"</span>: image_url</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the request</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(vision_url, headers<span class="op">=</span>headers, params<span class="op">=</span>params, json<span class="op">=</span>body)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the analysis results</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling Azure Vision API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="secure-authentication-and-api-key-management" class="level2" data-number="28.6">
<h2 data-number="28.6" class="anchored" data-anchor-id="secure-authentication-and-api-key-management"><span class="header-section-number">28.6</span> 7. Secure Authentication and API Key Management</h2>
<p>When integrating with AI services, proper handling of API keys and authentication is crucial.</p>
<section id="using-environment-variables" class="level3" data-number="28.6.1">
<h3 data-number="28.6.1" class="anchored" data-anchor-id="using-environment-variables"><span class="header-section-number">28.6.1</span> Using Environment Variables</h3>
<p>The simplest approach is to use environment variables:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from a .env file</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Access API keys</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>openai_api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>azure_api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_API_KEY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You would create a <code>.env</code> file with your keys:</p>
<pre><code>OPENAI_API_KEY=sk-your-key-here
AZURE_API_KEY=your-azure-key-here</code></pre>
<p><strong>Important:</strong> Add <code>.env</code> to your <code>.gitignore</code> file to avoid accidentally committing API keys.</p>
</section>
<section id="secure-key-storage-options" class="level3" data-number="28.6.2">
<h3 data-number="28.6.2" class="anchored" data-anchor-id="secure-key-storage-options"><span class="header-section-number">28.6.2</span> Secure Key Storage Options</h3>
<p>For more robust applications, consider:</p>
<ol type="1">
<li><strong>Secret management services</strong>: AWS Secrets Manager, Azure Key Vault, HashiCorp Vault</li>
<li><strong>Database storage</strong>: Encrypted database fields for API keys</li>
<li><strong>Configuration management</strong>: Tools like Ansible or Chef with encryption</li>
</ol>
<p>Example using AWS Secrets Manager:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_secret(secret_name, region_name<span class="op">=</span><span class="st">"us-west-2"</span>):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Retrieve a secret from AWS Secrets Manager."""</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Secrets Manager client</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    session <span class="op">=</span> boto3.session.Session()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> session.client(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        service_name<span class="op">=</span><span class="st">'secretsmanager'</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        region_name<span class="op">=</span>region_name</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the secret value</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> client.get_secret_value(SecretId<span class="op">=</span>secret_name)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the secret JSON</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'SecretString'</span> <span class="kw">in</span> response:</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            secret <span class="op">=</span> json.loads(response[<span class="st">'SecretString'</span>])</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> secret</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Binary secrets need to be decoded</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response[<span class="st">'SecretBinary'</span>]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error retrieving secret: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>secrets <span class="op">=</span> get_secret(<span class="st">"ai-service-keys"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>openai_api_key <span class="op">=</span> secrets.get(<span class="st">"OPENAI_API_KEY"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="testing-and-troubleshooting-ai-integrations" class="level2" data-number="28.7">
<h2 data-number="28.7" class="anchored" data-anchor-id="testing-and-troubleshooting-ai-integrations"><span class="header-section-number">28.7</span> 8. Testing and Troubleshooting AI Integrations</h2>
<p>Testing AI integrations can be challenging due to rate limits, costs, and the sometimes non-deterministic nature of AI responses.</p>
<section id="creating-test-fixtures-for-ai-apis" class="level3" data-number="28.7.1">
<h3 data-number="28.7.1" class="anchored" data-anchor-id="creating-test-fixtures-for-ai-apis"><span class="header-section-number">28.7.1</span> Creating Test Fixtures for AI APIs</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unittest</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> patch, MagicMock</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MockResponse:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A mock Response object for testing."""</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, status_code, json_data):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.status_code <span class="op">=</span> status_code</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.json_data <span class="op">=</span> json_data</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text <span class="op">=</span> json.dumps(json_data)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> json(<span class="va">self</span>):</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.json_data</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> raise_for_status(<span class="va">self</span>):</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.status_code <span class="op">&gt;=</span> <span class="dv">400</span>:</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"HTTP Error: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestOpenAIIntegration(unittest.TestCase):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setUp(<span class="va">self</span>):</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load test fixtures</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        fixture_path <span class="op">=</span> os.path.join(os.path.dirname(<span class="va">__file__</span>), <span class="st">"fixtures"</span>, <span class="st">"openai_response.json"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(fixture_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.mock_openai_response <span class="op">=</span> json.load(f)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">@patch</span>(<span class="st">'requests.post'</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_generate_text(<span class="va">self</span>, mock_post):</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configure the mock</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        mock_post.return_value <span class="op">=</span> MockResponse(<span class="dv">200</span>, <span class="va">self</span>.mock_openai_response)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Import the function to test</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> my_ai_module <span class="im">import</span> generate_text</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call the function</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> generate_text(<span class="st">"Test prompt"</span>, api_key<span class="op">=</span><span class="st">"fake_key"</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assert the result</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertIsNotNone(result)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertIn(<span class="st">"This is a test response"</span>, result)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify the API was called correctly</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        mock_post.assert_called_once()</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        args, kwargs <span class="op">=</span> mock_post.call_args</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(kwargs[<span class="st">'headers'</span>][<span class="st">'Authorization'</span>], <span class="st">"Bearer fake_key"</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> json.loads(kwargs[<span class="st">'data'</span>])</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(payload[<span class="st">'messages'</span>][<span class="dv">0</span>][<span class="st">'content'</span>], <span class="st">"Test prompt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-a-test-mode-for-ai-dependent-features" class="level3" data-number="28.7.2">
<h3 data-number="28.7.2" class="anchored" data-anchor-id="creating-a-test-mode-for-ai-dependent-features"><span class="header-section-number">28.7.2</span> Creating a Test Mode for AI-Dependent Features</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIService:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A service that integrates with AI APIs."""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key<span class="op">=</span><span class="va">None</span>, test_mode<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the AI service.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str, optional): API key for the service</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">            test_mode (bool): If True, use mock responses instead of real API calls</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key <span class="kw">or</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_mode <span class="op">=</span> test_mode</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load test responses if in test mode</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> test_mode:</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._load_test_responses()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_test_responses(<span class="va">self</span>):</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load mock responses for test mode."""</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_responses <span class="op">=</span> {</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"greeting"</span>: <span class="st">"Hello! This is a test response."</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"question"</span>: <span class="st">"This is a mock answer to your question."</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"default"</span>: <span class="st">"This is a default test response."</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_completion(<span class="va">self</span>, prompt):</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Get a completion from the AI.</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">            prompt (str): The prompt to send</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">            str: The AI's response</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If in test mode, return a mock response</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.test_mode:</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"hello"</span> <span class="kw">in</span> prompt.lower() <span class="kw">or</span> <span class="st">"hi"</span> <span class="kw">in</span> prompt.lower():</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"greeting"</span>]</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">"?"</span> <span class="kw">in</span> prompt:</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"question"</span>]</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"default"</span>]</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otherwise, call the real API</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">150</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error calling AI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Error: Could not get response from AI service."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="project-corner-enhancing-your-chatbot-with-ai" class="level2" data-number="28.8">
<h2 data-number="28.8" class="anchored" data-anchor-id="project-corner-enhancing-your-chatbot-with-ai"><span class="header-section-number">28.8</span> 9. Project Corner: Enhancing Your Chatbot with AI</h2>
<p>Now let’s apply these AI integration techniques to enhance our chatbot project with more advanced capabilities.</p>
<section id="adding-ai-powered-understanding-to-the-chatbot" class="level3" data-number="28.8.1">
<h3 data-number="28.8.1" class="anchored" data-anchor-id="adding-ai-powered-understanding-to-the-chatbot"><span class="header-section-number">28.8.1</span> Adding AI-Powered Understanding to the Chatbot</h3>
<p>First, let’s create a class that uses AI to better understand user messages:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MessageUnderstanding:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A class that uses AI to understand user messages."""</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load environment variables if needed</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        load_dotenv()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set API key</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key <span class="kw">or</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Warning: No OpenAI API key provided. AI features will not work."</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_intent(<span class="va">self</span>, message):</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Analyze the intent of a user message.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">            message (str): The user's message</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">            dict: Intent analysis with confidence scores</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"intent"</span>: <span class="st">"unknown"</span>, <span class="st">"confidence"</span>: <span class="fl">0.0</span>}</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create the prompt for intent analysis</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="ss">            Analyze the following message and determine the user's intent.</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="ss">            Return ONLY a JSON object with "intent" and "confidence" fields.</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="ss">            Possible intents: greeting, farewell, question, request, complaint, smalltalk, other</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="ss">            Message: "</span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="ss">            JSON:</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Call the API</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Parse the response as JSON</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> json</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>            result_text <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle potential formatting in the response</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Try to parse the raw response</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> json.loads(result_text)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If that fails, try to extract JSON from the text</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>                <span class="im">import</span> re</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>                json_match <span class="op">=</span> re.search(<span class="vs">r'\{.*\}'</span>, result_text, re.DOTALL)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> json_match:</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> json.loads(json_match.group(<span class="dv">0</span>))</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Could not parse JSON from response"</span>)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error analyzing intent: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"intent"</span>: <span class="st">"unknown"</span>, <span class="st">"confidence"</span>: <span class="fl">0.0</span>}</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_entities(<span class="va">self</span>, message):</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co">        Extract entities from a user message.</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co">            message (str): The user's message</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co">            dict: Extracted entities by type</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create the prompt for entity extraction</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="ss">            Extract entities from the following message.</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="ss">            Return ONLY a JSON object where keys are entity types and values are the extracted entities.</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="ss">            Possible entity types: person, location, organization, date_time, product, quantity, other</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="ss">            Message: "</span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="ss">            JSON:</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Call the API</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Parse the response as JSON</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> json</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>            result_text <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle potential formatting in the response</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Try to parse the raw response</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> json.loads(result_text)</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If that fails, try to extract JSON from the text</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>                <span class="im">import</span> re</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>                json_match <span class="op">=</span> re.search(<span class="vs">r'\{.*\}'</span>, result_text, re.DOTALL)</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> json_match:</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> json.loads(json_match.group(<span class="dv">0</span>))</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Could not parse JSON from response"</span>)</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error extracting entities: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ai-enhanced-chatbot-implementation" class="level3" data-number="28.8.2">
<h3 data-number="28.8.2" class="anchored" data-anchor-id="ai-enhanced-chatbot-implementation"><span class="header-section-number">28.8.2</span> AI-Enhanced Chatbot Implementation</h3>
<p>Now, let’s integrate this into our chatbot:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIEnhancedChatbot:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chatbot enhanced with AI capabilities."""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">"AI Chatbot"</span>, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the AI-enhanced chatbot.</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">            name (str): The chatbot's name</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str, optional): API key for AI services</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversation_history <span class="op">=</span> []</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize AI components</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.message_understanding <span class="op">=</span> MessageUnderstanding(api_key)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversational_ai <span class="op">=</span> ConversationalAI(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            api_key<span class="op">=</span>api_key,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            system_prompt<span class="op">=</span><span class="ss">f"You are </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">, a helpful assistant. Keep responses concise and friendly."</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flag to control AI usage</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.use_ai <span class="op">=</span> <span class="va">True</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> greet(<span class="va">self</span>):</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Greet the user and get their name."""</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Hello! I'm </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">, an AI-enhanced chatbot. Type 'bye' to exit."</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_name <span class="op">=</span> <span class="bu">input</span>(<span class="st">"What's your name? "</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Nice to meet you, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">!"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_to_history(<span class="st">"SYSTEM"</span>, <span class="ss">f"Conversation started with </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_to_history(<span class="va">self</span>, speaker, text):</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add a message to the conversation history."""</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        timestamp <span class="op">=</span> datetime.now().strftime(<span class="st">"%H:%M:%S"</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        entry <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>speaker<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversation_history.append(entry)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_response(<span class="va">self</span>, user_input):</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate a response to the user input using AI capabilities."""</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle special commands</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> user_input.lower() <span class="op">==</span> <span class="st">"help"</span>:</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_help()</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> user_input.lower() <span class="op">==</span> <span class="st">"history"</span>:</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.show_history()</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> user_input.lower() <span class="op">==</span> <span class="st">"toggle ai"</span>:</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.use_ai <span class="op">=</span> <span class="kw">not</span> <span class="va">self</span>.use_ai</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"AI features turned </span><span class="sc">{</span><span class="st">'on'</span> <span class="cf">if</span> <span class="va">self</span><span class="sc">.</span>use_ai <span class="cf">else</span> <span class="st">'off'</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.use_ai:</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fall back to rule-based response if AI is disabled</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_rule_based_response(user_input)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use AI to understand the message</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            intent_analysis <span class="op">=</span> <span class="va">self</span>.message_understanding.analyze_intent(user_input)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>            entities <span class="op">=</span> <span class="va">self</span>.message_understanding.extract_entities(user_input)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log the understanding (in a real system, you might not show this to the user)</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>            understanding_log <span class="op">=</span> <span class="ss">f"Intent: </span><span class="sc">{</span>intent_analysis<span class="sc">.</span>get(<span class="st">'intent'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>intent_analysis<span class="sc">.</span>get(<span class="st">'confidence'</span>, <span class="dv">0</span>)<span class="sc">:.2f}</span><span class="ss">)"</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> entities:</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>                understanding_log <span class="op">+=</span> <span class="ss">f", Entities: </span><span class="sc">{</span>entities<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="st">"SYSTEM"</span>, understanding_log)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get a response from the conversational AI</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>            ai_response <span class="op">=</span> <span class="va">self</span>.conversational_ai.get_response(user_input)</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ai_response</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error in AI processing: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fall back to rule-based response if AI fails</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_rule_based_response(user_input)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_rule_based_response(<span class="va">self</span>, user_input):</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate a response using simple rule-based patterns."""</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>        user_input <span class="op">=</span> user_input.lower()</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"hello"</span> <span class="kw">in</span> user_input <span class="kw">or</span> <span class="st">"hi"</span> <span class="kw">in</span> user_input:</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! How can I help you today?"</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"how are you"</span> <span class="kw">in</span> user_input:</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm doing well, thank you for asking!"</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"your name"</span> <span class="kw">in</span> user_input:</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"My name is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">. I'm an AI-enhanced chatbot."</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"bye"</span> <span class="kw">in</span> user_input <span class="kw">or</span> <span class="st">"goodbye"</span> <span class="kw">in</span> user_input:</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Goodbye, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! It was nice chatting with you."</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm not sure how to respond to that. Can you try asking something else?"</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> show_history(<span class="va">self</span>):</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Show the conversation history."""</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.conversation_history:</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"No conversation history yet."</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        history <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">----- Conversation History -----</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.conversation_history:</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>            history <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>entry<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>        history <span class="op">+=</span> <span class="st">"-------------------------------"</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> history</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_help(<span class="va">self</span>):</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get help information."""</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>        help_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="ss">Available Commands:</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'help': Display this help message</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'history': Show conversation history</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'toggle ai': Turn AI features on/off</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'bye': End the conversation</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a><span class="ss">You can also just chat with me normally, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">!</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> help_text</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Run the main chatbot loop."""</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.greet()</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>            user_input <span class="op">=</span> <span class="bu">input</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">&gt; "</span>)</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="va">self</span>.user_name, user_input)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> user_input.lower() <span class="op">==</span> <span class="st">"bye"</span>:</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>                response <span class="op">=</span> <span class="ss">f"Goodbye, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! I hope to chat again soon."</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">&gt; </span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.add_to_history(<span class="va">self</span>.name, response)</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.get_response(user_input)</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">&gt; </span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="va">self</span>.name, response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="running-the-ai-enhanced-chatbot" class="level3" data-number="28.8.3">
<h3 data-number="28.8.3" class="anchored" data-anchor-id="running-the-ai-enhanced-chatbot"><span class="header-section-number">28.8.3</span> Running the AI-Enhanced Chatbot</h3>
<p>Here’s how you might run the AI-enhanced chatbot:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Import necessary modules</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load environment variables</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    load_dotenv()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if API key is available</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> api_key:</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Warning: No OpenAI API key found in environment variables."</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The chatbot will run with limited AI capabilities."</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ask if user wants to proceed</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        proceed <span class="op">=</span> <span class="bu">input</span>(<span class="st">"Do you want to continue without AI features? (y/n): "</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proceed.lower() <span class="op">!=</span> <span class="st">"y"</span>:</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Exiting. Please set up an API key in a .env file to use AI features."</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            exit()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and run the chatbot</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    chatbot <span class="op">=</span> AIEnhancedChatbot(name<span class="op">=</span><span class="st">"AIBot"</span>, api_key<span class="op">=</span>api_key)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    chatbot.run()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="handling-api-costs-and-rate-limits" class="level2" data-number="28.9">
<h2 data-number="28.9" class="anchored" data-anchor-id="handling-api-costs-and-rate-limits"><span class="header-section-number">28.9</span> 10. Handling API Costs and Rate Limits</h2>
<p>When using AI services in your chatbot, it’s important to be mindful of costs and rate limits:</p>
<ol type="1">
<li><strong>Track usage</strong>: Implement a counter for API calls and log costs</li>
<li><strong>Set limits</strong>: Define maximum daily/monthly usage thresholds</li>
<li><strong>Cache responses</strong>: Store responses for common queries</li>
<li><strong>Use fallbacks</strong>: Implement rule-based responses as fallbacks</li>
<li><strong>Tier your approach</strong>: Use cheaper AI services for routine tasks, reserve expensive ones for complex queries</li>
</ol>
<p>Here’s an example of a cost-tracking wrapper:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CostTrackingAI:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A wrapper for AI services that tracks usage and costs."""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key, cost_per_1k_tokens<span class="op">=</span><span class="fl">0.002</span>, daily_budget<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the cost tracking AI wrapper.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str): API key for the service</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">            cost_per_1k_tokens (float): Cost per 1000 tokens in USD</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">            daily_budget (float): Maximum daily budget in USD</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost_per_1k_tokens <span class="op">=</span> cost_per_1k_tokens</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.daily_budget <span class="op">=</span> daily_budget</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize usage tracking</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokens_used_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.requests_made_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.estimated_cost_today <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the OpenAI client</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        openai.api_key <span class="op">=</span> api_key</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the date for tracking</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_date <span class="op">=</span> date.today()</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update_date(<span class="va">self</span>):</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Update the current date and reset counters if needed."""</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        today <span class="op">=</span> date.today()</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> today <span class="op">&gt;</span> <span class="va">self</span>.current_date:</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># It's a new day, reset counters</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.current_date <span class="op">=</span> today</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tokens_used_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.requests_made_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.estimated_cost_today <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update_usage(<span class="va">self</span>, tokens_used):</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Update usage statistics.</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co">            tokens_used (int): Number of tokens used in the request</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._update_date()</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokens_used_today <span class="op">+=</span> tokens_used</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.requests_made_today <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate cost</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> (tokens_used <span class="op">/</span> <span class="dv">1000</span>) <span class="op">*</span> <span class="va">self</span>.cost_per_1k_tokens</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.estimated_cost_today <span class="op">+=</span> cost</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> can_make_request(<span class="va">self</span>, estimated_tokens<span class="op">=</span><span class="dv">500</span>):</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Check if a request can be made within budget constraints.</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="co">            estimated_tokens (int): Estimated tokens for the request</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="co">            bool: True if the request can be made, False otherwise</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._update_date()</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate cost of this request</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        estimated_cost <span class="op">=</span> (estimated_tokens <span class="op">/</span> <span class="dv">1000</span>) <span class="op">*</span> <span class="va">self</span>.cost_per_1k_tokens</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if it would exceed the budget</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.estimated_cost_today <span class="op">+</span> estimated_cost) <span class="op">&lt;=</span> <span class="va">self</span>.daily_budget</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_completion(<span class="va">self</span>, prompt, max_tokens<span class="op">=</span><span class="dv">150</span>):</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co">        Get a completion from the AI while tracking costs.</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co">            prompt (str): The prompt to send</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="co">            max_tokens (int): Maximum tokens in the response</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="co">            str: The AI's response</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if we can make the request</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.can_make_request(estimated_tokens<span class="op">=</span><span class="bu">len</span>(prompt.split()) <span class="op">+</span> max_tokens):</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm sorry, I've reached my usage limit for today. Please try again tomorrow."</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make the API call</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span>max_tokens</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Update usage tracking</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>            prompt_tokens <span class="op">=</span> response.usage.prompt_tokens</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>            completion_tokens <span class="op">=</span> response.usage.completion_tokens</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>            total_tokens <span class="op">=</span> response.usage.total_tokens</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update_usage(total_tokens)</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log usage</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Request used </span><span class="sc">{</span>total_tokens<span class="sc">}</span><span class="ss"> tokens ($</span><span class="sc">{</span>(total_tokens<span class="op">/</span><span class="dv">1000</span>)<span class="op">*</span><span class="va">self</span><span class="sc">.</span>cost_per_1k_tokens<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Daily usage: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>tokens_used_today<span class="sc">}</span><span class="ss"> tokens, Est. cost: $</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>estimated_cost_today<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error in AI request: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Sorry, I encountered an error processing your request."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cross-references" class="level2" data-number="28.10">
<h2 data-number="28.10" class="anchored" data-anchor-id="cross-references"><span class="header-section-number">28.10</span> Cross-References</h2>
<ul>
<li>Previous Chapter: <a href="AI_Programming_Assistants.qmd">AI Programming Assistants</a></li>
<li>Next Chapter: <a href="AI_Assistance_Tips.qmd">AI Assistance Tips</a></li>
<li>Related Topics: Object-Oriented Programming (Chapter 20), Modules and Packages (Chapter 19)</li>
</ul>
<p><strong><em>AI Tip: When integrating AI APIs with Python, follow the “graceful degradation” pattern - design your system to work in a reduced capacity when AI services are unavailable or when rate limits are reached. This ensures your application remains functional even when AI services are temporarily inaccessible.</em></strong></p>
</section>
<section id="summary" class="level2" data-number="28.11">
<h2 data-number="28.11" class="anchored" data-anchor-id="summary"><span class="header-section-number">28.11</span> Summary</h2>
<p>In this chapter, we’ve explored how to integrate AI capabilities into Python applications:</p>
<ol type="1">
<li><p>We began by understanding the landscape of AI services available for Python integration, from LLMs to vision and speech processing.</p></li>
<li><p>We learned how to make direct API calls to AI services using Python’s requests library, and how to use specialized SDKs for more convenient integration.</p></li>
<li><p>We implemented various text processing capabilities, including sentiment analysis, named entity recognition, and text summarization.</p></li>
<li><p>We built conversational AI features, both stateless and with conversation memory, to enable more natural interactions.</p></li>
<li><p>We covered important practical considerations, including API authentication, testing strategies, and cost management.</p></li>
<li><p>Finally, we applied these techniques to enhance our chatbot project with AI capabilities, making it more intelligent and helpful.</p></li>
</ol>
<p>As AI services continue to evolve and become more accessible, the ability to integrate them into Python applications will be an increasingly valuable skill. By understanding the patterns and practices covered in this chapter, you’re well-equipped to build applications that leverage the power of AI, even without deep expertise in machine learning or data science.</p>
<p>Remember that integrating external AI services involves trade-offs in terms of cost, privacy, and dependence on third-party systems. Always consider these factors when deciding whether and how to incorporate AI into your Python projects.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/24_ai_programming_assistants.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">AI Programming Assistants: Coding with Digital Colleagues</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/26_ai_assistance_tips.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">AI Assistance Tips: Maximizing Your Machine Learning Mentors</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Python AI Integration: Connecting Your Code to Intelligent Services"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 25: Python AI Integration</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter Outline</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understanding the AI integration landscape for Python</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Working with AI APIs and services</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using popular Python libraries for AI integration</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Building text and image processing capabilities</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implementing conversational AI in Python applications</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handling API authentication and usage limits</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Testing and troubleshooting AI integrations</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enhancing your chatbot with external AI capabilities</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will be able to:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand the ecosystem of AI services available for Python integration</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Connect to AI APIs using Python's requests library</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement basic text analysis using natural language processing (NLP) services</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use Python to access image recognition and generation capabilities</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add conversational AI features to Python applications</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handle authentication and API key management securely</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test and troubleshoot common AI integration issues</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enhance your chatbot with external AI capabilities</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Introduction: Connecting Python to AI Capabilities</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>While Python itself is a powerful programming language, it becomes even more powerful when connected to external AI services. Modern AI capabilities like natural language understanding, image recognition, and text generation are now accessible through simple API calls, allowing Python developers to create increasingly intelligent applications without needing to train their own AI models.</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>This chapter explores how to integrate these AI capabilities into your Python applications. We'll focus on practical integration patterns rather than the theory behind AI models, giving you the tools to enhance your projects with AI features regardless of your background in machine learning.</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>The skills you'll learn in this chapter represent a significant trend in modern programming: the ability to compose applications by connecting to specialized AI services rather than building everything from scratch. This approach lets you leverage cutting-edge AI research in your projects without requiring expertise in data science or machine learning.</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>***AI Tip: When integrating AI services into your Python applications, always start with a minimal proof-of-concept to test the API connection and response format before building more complex features. This helps identify integration issues early and ensures you understand the service's capabilities and limitations.***</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. The AI Integration Landscape</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>The AI services landscape offers a variety of options for Python developers, ranging from general-purpose AI platforms to specialized services for specific tasks.</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of AI Services</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Large Language Models (LLMs)**</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Services like OpenAI's GPT models, Anthropic's Claude, or Google's Gemini</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Capabilities include text generation, summarization, translation, and question answering</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Access through REST APIs with API key authentication</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Vision AI Services**</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Image classification, object detection, OCR (Optical Character Recognition)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Available through Google Cloud Vision, Azure Computer Vision, AWS Rekognition</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Typically requires sending image data and receiving structured analysis</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Speech and Audio Services**</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Speech-to-text, text-to-speech, audio analysis</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Google Cloud Speech, Amazon Transcribe, Azure Speech Services</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Often involves streaming audio or uploading audio files</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Specialized NLP Services**</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sentiment analysis, named entity recognition, language detection</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Available through various providers or as standalone APIs</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Usually takes text input and returns structured analysis</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Multi-modal Services**</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Combining text, image, audio in a single API</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Examples include OpenAI's GPT-4 Vision, Google's Gemini, Anthropic's Claude Opus</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Allows for more complex interactions like "describe this image" or "create an image based on this text"</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integration Models</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>When integrating AI services, you'll generally use one of these patterns:</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**REST API Integration**</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Making HTTP requests to AI service endpoints</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sending data in JSON format and processing JSON responses</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Managing authentication through API keys or OAuth tokens</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**SDK-based Integration**</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Using official Python libraries provided by AI service vendors</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Typically wraps the REST API with Python-friendly interfaces</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Often handles authentication and request formatting</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Library-based Integration**</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Using third-party Python libraries that abstract away the API details</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>May provide higher-level functionality or combine multiple services</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Examples include LangChain, LlamaIndex, and similar frameworks</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Self-hosted Models**</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Running open-source AI models directly in your application</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Libraries like Hugging Face's Transformers make this possible</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Requires more computational resources but reduces API costs and latency</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Getting Started with AI API Integration</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>Let's start with the most common integration pattern: connecting to an AI service via REST API.</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic API Integration Pattern</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>Most AI API integrations follow a similar pattern:</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Sign up for the service and obtain API credentials</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Install the necessary Python packages (<span class="in">`requests`</span> at minimum)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Prepare your data for the API request</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Make the API call</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Process and use the response</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: Text Generation with OpenAI</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>Here's a basic example of integrating with OpenAI's API:</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_text(prompt, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate text using OpenAI's API.</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="co">        prompt (str): The text prompt to send to the API</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): OpenAI API key. If None, uses environment variable.</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The generated text response</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment variable if not provided</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as OPENAI_API_KEY environment variable"</span>)</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API endpoint</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.openai.com/v1/chat/completions"</span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare the request payload</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: <span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">"messages"</span>: [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature"</span>: <span class="fl">0.7</span>,</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_tokens"</span>: <span class="dv">150</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare headers with authentication</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"Bearer </span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the API request</span></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>json.dumps(payload))</span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()  <span class="co"># Raise exception for HTTP errors</span></span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the response</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>        response_data <span class="op">=</span> response.json()</span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the generated text</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>        generated_text <span class="op">=</span> response_data[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generated_text.strip()</span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling OpenAI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: Image Analysis with Azure Computer Vision</span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>Here's how you might integrate with Microsoft Azure's Computer Vision service:</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_image(image_url, api_key<span class="op">=</span><span class="va">None</span>, endpoint<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze an image using Azure Computer Vision API.</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a><span class="co">        image_url (str): URL of the image to analyze</span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): Azure API key. If None, uses environment variable.</span></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint (str, optional): Azure endpoint. If None, uses environment variable.</span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The analysis results</span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get credentials from environment variables if not provided</span></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_API_KEY"</span>)</span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as AZURE_VISION_API_KEY environment variable"</span>)</span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>        endpoint <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_ENDPOINT"</span>)</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Endpoint must be provided or set as AZURE_VISION_ENDPOINT environment variable"</span>)</span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API URL</span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>    vision_url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">/vision/v3.2/analyze"</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>        <span class="st">"visualFeatures"</span>: <span class="st">"Categories,Description,Objects"</span>,</span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>        <span class="st">"language"</span>: <span class="st">"en"</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Headers</span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ocp-Apim-Subscription-Key"</span>: api_key</span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Request body</span></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> {</span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a>        <span class="st">"url"</span>: image_url</span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the request</span></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(vision_url, headers<span class="op">=</span>headers, params<span class="op">=</span>params, json<span class="op">=</span>body)</span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the analysis results</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling Azure Vision API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a>title: 'AI Integrator: Connecting Python Applications to AI Services'</span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a>jupyter: python3</span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 25: Python AI Integration</span></span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter Outline</span></span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understanding the AI integration landscape for Python</span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Working with AI APIs and services</span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using popular Python libraries for AI integration</span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Building text and image processing capabilities</span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implementing conversational AI in Python applications</span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handling API authentication and usage limits</span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Testing and troubleshooting AI integrations</span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enhancing your chatbot with external AI capabilities</span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will be able to:</span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand the ecosystem of AI services available for Python integration</span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Connect to AI APIs using Python's requests library</span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Implement basic text analysis using natural language processing (NLP) services</span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use Python to access image recognition and generation capabilities</span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add conversational AI features to Python applications</span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handle authentication and API key management securely</span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test and troubleshoot common AI integration issues</span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enhance your chatbot with external AI capabilities</span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Introduction: Connecting Python to AI Capabilities</span></span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a>While Python itself is a powerful programming language, it becomes even more powerful when connected to external AI services. Modern AI capabilities like natural language understanding, image recognition, and text generation are now accessible through simple API calls, allowing Python developers to create increasingly intelligent applications without needing to train their own AI models.</span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a>This chapter explores how to integrate these AI capabilities into your Python applications. We'll focus on practical integration patterns rather than the theory behind AI models, giving you the tools to enhance your projects with AI features regardless of your background in machine learning.</span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a>The skills you'll learn in this chapter represent a significant trend in modern programming: the ability to compose applications by connecting to specialized AI services rather than building everything from scratch. This approach lets you leverage cutting-edge AI research in your projects without requiring expertise in data science or machine learning.</span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a>***AI Tip: When integrating AI services into your Python applications, always start with a minimal proof-of-concept to test the API connection and response format before building more complex features. This helps identify integration issues early and ensures you understand the service's capabilities and limitations.***</span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. The AI Integration Landscape</span></span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a>The AI services landscape offers a variety of options for Python developers, ranging from general-purpose AI platforms to specialized services for specific tasks.</span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of AI Services</span></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Large Language Models (LLMs)**</span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Services like OpenAI's GPT models, Anthropic's Claude, or Google's Gemini</span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Capabilities include text generation, summarization, translation, and question answering</span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Access through REST APIs with API key authentication</span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Vision AI Services**</span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Image classification, object detection, OCR (Optical Character Recognition)</span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Available through Google Cloud Vision, Azure Computer Vision, AWS Rekognition</span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Typically requires sending image data and receiving structured analysis</span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Speech and Audio Services**</span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Speech-to-text, text-to-speech, audio analysis</span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Google Cloud Speech, Amazon Transcribe, Azure Speech Services</span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Often involves streaming audio or uploading audio files</span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Specialized NLP Services**</span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sentiment analysis, named entity recognition, language detection</span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Available through various providers or as standalone APIs</span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Usually takes text input and returns structured analysis</span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Multi-modal Services**</span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Combining text, image, audio in a single API</span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Examples include OpenAI's GPT-4 Vision, Google's Gemini, Anthropic's Claude Opus</span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Allows for more complex interactions like "describe this image" or "create an image based on this text"</span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Integration Models</span></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a>When integrating AI services, you'll generally use one of these patterns:</span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**REST API Integration**</span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Making HTTP requests to AI service endpoints</span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sending data in JSON format and processing JSON responses</span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Managing authentication through API keys or OAuth tokens</span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**SDK-based Integration**</span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Using official Python libraries provided by AI service vendors</span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Typically wraps the REST API with Python-friendly interfaces</span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Often handles authentication and request formatting</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Library-based Integration**</span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Using third-party Python libraries that abstract away the API details</span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>May provide higher-level functionality or combine multiple services</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Examples include LangChain, LlamaIndex, and similar frameworks</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Self-hosted Models**</span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Running open-source AI models directly in your application</span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Libraries like Hugging Face's Transformers make this possible</span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Requires more computational resources but reduces API costs and latency</span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Getting Started with AI API Integration</span></span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>Let's start with the most common integration pattern: connecting to an AI service via REST API.</span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic API Integration Pattern</span></span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-338"><a href="#cb14-338" aria-hidden="true" tabindex="-1"></a>Most AI API integrations follow a similar pattern:</span>
<span id="cb14-339"><a href="#cb14-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Sign up for the service and obtain API credentials</span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Install the necessary Python packages (<span class="in">`requests`</span> at minimum)</span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Prepare your data for the API request</span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Make the API call</span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Process and use the response</span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: Text Generation with OpenAI</span></span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a>Here's a basic example of integrating with OpenAI's API:</span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_text(prompt, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate text using OpenAI's API.</span></span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a><span class="co">        prompt (str): The text prompt to send to the API</span></span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): OpenAI API key. If None, uses environment variable.</span></span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The generated text response</span></span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment variable if not provided</span></span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as OPENAI_API_KEY environment variable"</span>)</span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API endpoint</span></span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://api.openai.com/v1/chat/completions"</span></span>
<span id="cb14-374"><a href="#cb14-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-375"><a href="#cb14-375" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare the request payload</span></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> {</span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: <span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a>        <span class="st">"messages"</span>: [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a>        <span class="st">"temperature"</span>: <span class="fl">0.7</span>,</span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_tokens"</span>: <span class="dv">150</span></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare headers with authentication</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"Bearer </span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the API request</span></span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(url, headers<span class="op">=</span>headers, data<span class="op">=</span>json.dumps(payload))</span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()  <span class="co"># Raise exception for HTTP errors</span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the response</span></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a>        response_data <span class="op">=</span> response.json()</span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the generated text</span></span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a>        generated_text <span class="op">=</span> response_data[<span class="st">"choices"</span>][<span class="dv">0</span>][<span class="st">"message"</span>][<span class="st">"content"</span>]</span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generated_text.strip()</span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling OpenAI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: Image Analysis with Azure Computer Vision</span></span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a>Here's how you might integrate with Microsoft Azure's Computer Vision service:</span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_image(image_url, api_key<span class="op">=</span><span class="va">None</span>, endpoint<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze an image using Azure Computer Vision API.</span></span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a><span class="co">        image_url (str): URL of the image to analyze</span></span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a><span class="co">        api_key (str, optional): Azure API key. If None, uses environment variable.</span></span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint (str, optional): Azure endpoint. If None, uses environment variable.</span></span>
<span id="cb14-425"><a href="#cb14-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-426"><a href="#cb14-426" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The analysis results</span></span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get credentials from environment variables if not provided</span></span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a>        api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_API_KEY"</span>)</span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> api_key <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"API key must be provided or set as AZURE_VISION_API_KEY environment variable"</span>)</span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a>        endpoint <span class="op">=</span> os.environ.get(<span class="st">"AZURE_VISION_ENDPOINT"</span>)</span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> endpoint <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Endpoint must be provided or set as AZURE_VISION_ENDPOINT environment variable"</span>)</span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a>    <span class="co"># API URL</span></span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a>    vision_url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>endpoint<span class="sc">}</span><span class="ss">/vision/v3.2/analyze"</span></span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a>        <span class="st">"visualFeatures"</span>: <span class="st">"Categories,Description,Objects"</span>,</span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a>        <span class="st">"language"</span>: <span class="st">"en"</span></span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Headers</span></span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Content-Type"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ocp-Apim-Subscription-Key"</span>: api_key</span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Request body</span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> {</span>
<span id="cb14-457"><a href="#cb14-457" aria-hidden="true" tabindex="-1"></a>        <span class="st">"url"</span>: image_url</span>
<span id="cb14-458"><a href="#cb14-458" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the request</span></span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(vision_url, headers<span class="op">=</span>headers, params<span class="op">=</span>params, json<span class="op">=</span>body)</span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the analysis results</span></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response.json()</span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error calling Azure Vision API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> response <span class="kw">and</span> response.text:</span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. Secure Authentication and API Key Management</span></span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a>When integrating with AI services, proper handling of API keys and authentication is crucial.</span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using Environment Variables</span></span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a>The simplest approach is to use environment variables:</span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from a .env file</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb14-489"><a href="#cb14-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-490"><a href="#cb14-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Access API keys</span></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a>openai_api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a>azure_api_key <span class="op">=</span> os.environ.get(<span class="st">"AZURE_API_KEY"</span>)</span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a>You would create a <span class="in">`.env`</span> file with your keys:</span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a><span class="in">OPENAI_API_KEY=sk-your-key-here</span></span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a><span class="in">AZURE_API_KEY=your-azure-key-here</span></span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a>**Important:** Add <span class="in">`.env`</span> to your <span class="in">`.gitignore`</span> file to avoid accidentally committing API keys.</span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a><span class="fu">### Secure Key Storage Options</span></span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a>For more robust applications, consider:</span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Secret management services**: AWS Secrets Manager, Azure Key Vault, HashiCorp Vault</span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Database storage**: Encrypted database fields for API keys</span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Configuration management**: Tools like Ansible or Chef with encryption</span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a>Example using AWS Secrets Manager:</span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_secret(secret_name, region_name<span class="op">=</span><span class="st">"us-west-2"</span>):</span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Retrieve a secret from AWS Secrets Manager."""</span></span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Secrets Manager client</span></span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a>    session <span class="op">=</span> boto3.session.Session()</span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> session.client(</span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a>        service_name<span class="op">=</span><span class="st">'secretsmanager'</span>,</span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a>        region_name<span class="op">=</span>region_name</span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the secret value</span></span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> client.get_secret_value(SecretId<span class="op">=</span>secret_name)</span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse the secret JSON</span></span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'SecretString'</span> <span class="kw">in</span> response:</span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a>            secret <span class="op">=</span> json.loads(response[<span class="st">'SecretString'</span>])</span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> secret</span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Binary secrets need to be decoded</span></span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response[<span class="st">'SecretBinary'</span>]</span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error retrieving secret: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a>secrets <span class="op">=</span> get_secret(<span class="st">"ai-service-keys"</span>)</span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a>openai_api_key <span class="op">=</span> secrets.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. Testing and Troubleshooting AI Integrations</span></span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a>Testing AI integrations can be challenging due to rate limits, costs, and the sometimes non-deterministic nature of AI responses.</span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Test Fixtures for AI APIs</span></span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unittest</span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> patch, MagicMock</span>
<span id="cb14-558"><a href="#cb14-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-559"><a href="#cb14-559" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MockResponse:</span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A mock Response object for testing."""</span></span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, status_code, json_data):</span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.status_code <span class="op">=</span> status_code</span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.json_data <span class="op">=</span> json_data</span>
<span id="cb14-565"><a href="#cb14-565" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text <span class="op">=</span> json.dumps(json_data)</span>
<span id="cb14-566"><a href="#cb14-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-567"><a href="#cb14-567" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> json(<span class="va">self</span>):</span>
<span id="cb14-568"><a href="#cb14-568" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.json_data</span>
<span id="cb14-569"><a href="#cb14-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-570"><a href="#cb14-570" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> raise_for_status(<span class="va">self</span>):</span>
<span id="cb14-571"><a href="#cb14-571" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.status_code <span class="op">&gt;=</span> <span class="dv">400</span>:</span>
<span id="cb14-572"><a href="#cb14-572" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"HTTP Error: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-573"><a href="#cb14-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-574"><a href="#cb14-574" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestOpenAIIntegration(unittest.TestCase):</span>
<span id="cb14-575"><a href="#cb14-575" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setUp(<span class="va">self</span>):</span>
<span id="cb14-576"><a href="#cb14-576" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load test fixtures</span></span>
<span id="cb14-577"><a href="#cb14-577" aria-hidden="true" tabindex="-1"></a>        fixture_path <span class="op">=</span> os.path.join(os.path.dirname(<span class="va">__file__</span>), <span class="st">"fixtures"</span>, <span class="st">"openai_response.json"</span>)</span>
<span id="cb14-578"><a href="#cb14-578" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(fixture_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb14-579"><a href="#cb14-579" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.mock_openai_response <span class="op">=</span> json.load(f)</span>
<span id="cb14-580"><a href="#cb14-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-581"><a href="#cb14-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">@patch</span>(<span class="st">'requests.post'</span>)</span>
<span id="cb14-582"><a href="#cb14-582" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_generate_text(<span class="va">self</span>, mock_post):</span>
<span id="cb14-583"><a href="#cb14-583" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Configure the mock</span></span>
<span id="cb14-584"><a href="#cb14-584" aria-hidden="true" tabindex="-1"></a>        mock_post.return_value <span class="op">=</span> MockResponse(<span class="dv">200</span>, <span class="va">self</span>.mock_openai_response)</span>
<span id="cb14-585"><a href="#cb14-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-586"><a href="#cb14-586" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Import the function to test</span></span>
<span id="cb14-587"><a href="#cb14-587" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> my_ai_module <span class="im">import</span> generate_text</span>
<span id="cb14-588"><a href="#cb14-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-589"><a href="#cb14-589" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call the function</span></span>
<span id="cb14-590"><a href="#cb14-590" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> generate_text(<span class="st">"Test prompt"</span>, api_key<span class="op">=</span><span class="st">"fake_key"</span>)</span>
<span id="cb14-591"><a href="#cb14-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-592"><a href="#cb14-592" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assert the result</span></span>
<span id="cb14-593"><a href="#cb14-593" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertIsNotNone(result)</span>
<span id="cb14-594"><a href="#cb14-594" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertIn(<span class="st">"This is a test response"</span>, result)</span>
<span id="cb14-595"><a href="#cb14-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-596"><a href="#cb14-596" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify the API was called correctly</span></span>
<span id="cb14-597"><a href="#cb14-597" aria-hidden="true" tabindex="-1"></a>        mock_post.assert_called_once()</span>
<span id="cb14-598"><a href="#cb14-598" aria-hidden="true" tabindex="-1"></a>        args, kwargs <span class="op">=</span> mock_post.call_args</span>
<span id="cb14-599"><a href="#cb14-599" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(kwargs[<span class="st">'headers'</span>][<span class="st">'Authorization'</span>], <span class="st">"Bearer fake_key"</span>)</span>
<span id="cb14-600"><a href="#cb14-600" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> json.loads(kwargs[<span class="st">'data'</span>])</span>
<span id="cb14-601"><a href="#cb14-601" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(payload[<span class="st">'messages'</span>][<span class="dv">0</span>][<span class="st">'content'</span>], <span class="st">"Test prompt"</span>)</span>
<span id="cb14-602"><a href="#cb14-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-603"><a href="#cb14-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-604"><a href="#cb14-604" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating a Test Mode for AI-Dependent Features</span></span>
<span id="cb14-605"><a href="#cb14-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-606"><a href="#cb14-606" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-607"><a href="#cb14-607" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIService:</span>
<span id="cb14-608"><a href="#cb14-608" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A service that integrates with AI APIs."""</span></span>
<span id="cb14-609"><a href="#cb14-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-610"><a href="#cb14-610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key<span class="op">=</span><span class="va">None</span>, test_mode<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb14-611"><a href="#cb14-611" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-612"><a href="#cb14-612" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the AI service.</span></span>
<span id="cb14-613"><a href="#cb14-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-614"><a href="#cb14-614" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-615"><a href="#cb14-615" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str, optional): API key for the service</span></span>
<span id="cb14-616"><a href="#cb14-616" aria-hidden="true" tabindex="-1"></a><span class="co">            test_mode (bool): If True, use mock responses instead of real API calls</span></span>
<span id="cb14-617"><a href="#cb14-617" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-618"><a href="#cb14-618" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key <span class="kw">or</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-619"><a href="#cb14-619" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_mode <span class="op">=</span> test_mode</span>
<span id="cb14-620"><a href="#cb14-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-621"><a href="#cb14-621" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load test responses if in test mode</span></span>
<span id="cb14-622"><a href="#cb14-622" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> test_mode:</span>
<span id="cb14-623"><a href="#cb14-623" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._load_test_responses()</span>
<span id="cb14-624"><a href="#cb14-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-625"><a href="#cb14-625" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_test_responses(<span class="va">self</span>):</span>
<span id="cb14-626"><a href="#cb14-626" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load mock responses for test mode."""</span></span>
<span id="cb14-627"><a href="#cb14-627" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.test_responses <span class="op">=</span> {</span>
<span id="cb14-628"><a href="#cb14-628" aria-hidden="true" tabindex="-1"></a>            <span class="st">"greeting"</span>: <span class="st">"Hello! This is a test response."</span>,</span>
<span id="cb14-629"><a href="#cb14-629" aria-hidden="true" tabindex="-1"></a>            <span class="st">"question"</span>: <span class="st">"This is a mock answer to your question."</span>,</span>
<span id="cb14-630"><a href="#cb14-630" aria-hidden="true" tabindex="-1"></a>            <span class="st">"default"</span>: <span class="st">"This is a default test response."</span></span>
<span id="cb14-631"><a href="#cb14-631" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-632"><a href="#cb14-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-633"><a href="#cb14-633" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_completion(<span class="va">self</span>, prompt):</span>
<span id="cb14-634"><a href="#cb14-634" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-635"><a href="#cb14-635" aria-hidden="true" tabindex="-1"></a><span class="co">        Get a completion from the AI.</span></span>
<span id="cb14-636"><a href="#cb14-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-637"><a href="#cb14-637" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-638"><a href="#cb14-638" aria-hidden="true" tabindex="-1"></a><span class="co">            prompt (str): The prompt to send</span></span>
<span id="cb14-639"><a href="#cb14-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-640"><a href="#cb14-640" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb14-641"><a href="#cb14-641" aria-hidden="true" tabindex="-1"></a><span class="co">            str: The AI's response</span></span>
<span id="cb14-642"><a href="#cb14-642" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-643"><a href="#cb14-643" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If in test mode, return a mock response</span></span>
<span id="cb14-644"><a href="#cb14-644" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.test_mode:</span>
<span id="cb14-645"><a href="#cb14-645" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"hello"</span> <span class="kw">in</span> prompt.lower() <span class="kw">or</span> <span class="st">"hi"</span> <span class="kw">in</span> prompt.lower():</span>
<span id="cb14-646"><a href="#cb14-646" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"greeting"</span>]</span>
<span id="cb14-647"><a href="#cb14-647" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">"?"</span> <span class="kw">in</span> prompt:</span>
<span id="cb14-648"><a href="#cb14-648" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"question"</span>]</span>
<span id="cb14-649"><a href="#cb14-649" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-650"><a href="#cb14-650" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>.test_responses[<span class="st">"default"</span>]</span>
<span id="cb14-651"><a href="#cb14-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-652"><a href="#cb14-652" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otherwise, call the real API</span></span>
<span id="cb14-653"><a href="#cb14-653" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-654"><a href="#cb14-654" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb14-655"><a href="#cb14-655" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb14-656"><a href="#cb14-656" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-657"><a href="#cb14-657" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-658"><a href="#cb14-658" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">150</span></span>
<span id="cb14-659"><a href="#cb14-659" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-660"><a href="#cb14-660" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb14-661"><a href="#cb14-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-662"><a href="#cb14-662" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error calling AI API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-663"><a href="#cb14-663" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Error: Could not get response from AI service."</span></span>
<span id="cb14-664"><a href="#cb14-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-665"><a href="#cb14-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-666"><a href="#cb14-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. Project Corner: Enhancing Your Chatbot with AI</span></span>
<span id="cb14-667"><a href="#cb14-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-668"><a href="#cb14-668" aria-hidden="true" tabindex="-1"></a>Now let's apply these AI integration techniques to enhance our chatbot project with more advanced capabilities.</span>
<span id="cb14-669"><a href="#cb14-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-670"><a href="#cb14-670" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding AI-Powered Understanding to the Chatbot</span></span>
<span id="cb14-671"><a href="#cb14-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-672"><a href="#cb14-672" aria-hidden="true" tabindex="-1"></a>First, let's create a class that uses AI to better understand user messages:</span>
<span id="cb14-673"><a href="#cb14-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-674"><a href="#cb14-674" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-675"><a href="#cb14-675" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb14-676"><a href="#cb14-676" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-677"><a href="#cb14-677" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb14-678"><a href="#cb14-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-679"><a href="#cb14-679" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MessageUnderstanding:</span>
<span id="cb14-680"><a href="#cb14-680" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A class that uses AI to understand user messages."""</span></span>
<span id="cb14-681"><a href="#cb14-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-682"><a href="#cb14-682" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-683"><a href="#cb14-683" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load environment variables if needed</span></span>
<span id="cb14-684"><a href="#cb14-684" aria-hidden="true" tabindex="-1"></a>        load_dotenv()</span>
<span id="cb14-685"><a href="#cb14-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-686"><a href="#cb14-686" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set API key</span></span>
<span id="cb14-687"><a href="#cb14-687" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key <span class="kw">or</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-688"><a href="#cb14-688" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb14-689"><a href="#cb14-689" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Warning: No OpenAI API key provided. AI features will not work."</span>)</span>
<span id="cb14-690"><a href="#cb14-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-691"><a href="#cb14-691" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_intent(<span class="va">self</span>, message):</span>
<span id="cb14-692"><a href="#cb14-692" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-693"><a href="#cb14-693" aria-hidden="true" tabindex="-1"></a><span class="co">        Analyze the intent of a user message.</span></span>
<span id="cb14-694"><a href="#cb14-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-695"><a href="#cb14-695" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-696"><a href="#cb14-696" aria-hidden="true" tabindex="-1"></a><span class="co">            message (str): The user's message</span></span>
<span id="cb14-697"><a href="#cb14-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-698"><a href="#cb14-698" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb14-699"><a href="#cb14-699" aria-hidden="true" tabindex="-1"></a><span class="co">            dict: Intent analysis with confidence scores</span></span>
<span id="cb14-700"><a href="#cb14-700" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-701"><a href="#cb14-701" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb14-702"><a href="#cb14-702" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"intent"</span>: <span class="st">"unknown"</span>, <span class="st">"confidence"</span>: <span class="fl">0.0</span>}</span>
<span id="cb14-703"><a href="#cb14-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-704"><a href="#cb14-704" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-705"><a href="#cb14-705" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create the prompt for intent analysis</span></span>
<span id="cb14-706"><a href="#cb14-706" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb14-707"><a href="#cb14-707" aria-hidden="true" tabindex="-1"></a><span class="ss">            Analyze the following message and determine the user's intent.</span></span>
<span id="cb14-708"><a href="#cb14-708" aria-hidden="true" tabindex="-1"></a><span class="ss">            Return ONLY a JSON object with "intent" and "confidence" fields.</span></span>
<span id="cb14-709"><a href="#cb14-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-710"><a href="#cb14-710" aria-hidden="true" tabindex="-1"></a><span class="ss">            Possible intents: greeting, farewell, question, request, complaint, smalltalk, other</span></span>
<span id="cb14-711"><a href="#cb14-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-712"><a href="#cb14-712" aria-hidden="true" tabindex="-1"></a><span class="ss">            Message: "</span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-713"><a href="#cb14-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-714"><a href="#cb14-714" aria-hidden="true" tabindex="-1"></a><span class="ss">            JSON:</span></span>
<span id="cb14-715"><a href="#cb14-715" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span></span>
<span id="cb14-716"><a href="#cb14-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-717"><a href="#cb14-717" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Call the API</span></span>
<span id="cb14-718"><a href="#cb14-718" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb14-719"><a href="#cb14-719" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb14-720"><a href="#cb14-720" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-721"><a href="#cb14-721" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-722"><a href="#cb14-722" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb14-723"><a href="#cb14-723" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb14-724"><a href="#cb14-724" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-725"><a href="#cb14-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-726"><a href="#cb14-726" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Parse the response as JSON</span></span>
<span id="cb14-727"><a href="#cb14-727" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> json</span>
<span id="cb14-728"><a href="#cb14-728" aria-hidden="true" tabindex="-1"></a>            result_text <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb14-729"><a href="#cb14-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-730"><a href="#cb14-730" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle potential formatting in the response</span></span>
<span id="cb14-731"><a href="#cb14-731" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb14-732"><a href="#cb14-732" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Try to parse the raw response</span></span>
<span id="cb14-733"><a href="#cb14-733" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> json.loads(result_text)</span>
<span id="cb14-734"><a href="#cb14-734" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb14-735"><a href="#cb14-735" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If that fails, try to extract JSON from the text</span></span>
<span id="cb14-736"><a href="#cb14-736" aria-hidden="true" tabindex="-1"></a>                <span class="im">import</span> re</span>
<span id="cb14-737"><a href="#cb14-737" aria-hidden="true" tabindex="-1"></a>                json_match <span class="op">=</span> re.search(<span class="vs">r'\{.*\}'</span>, result_text, re.DOTALL)</span>
<span id="cb14-738"><a href="#cb14-738" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> json_match:</span>
<span id="cb14-739"><a href="#cb14-739" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> json.loads(json_match.group(<span class="dv">0</span>))</span>
<span id="cb14-740"><a href="#cb14-740" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-741"><a href="#cb14-741" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Could not parse JSON from response"</span>)</span>
<span id="cb14-742"><a href="#cb14-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-743"><a href="#cb14-743" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb14-744"><a href="#cb14-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-745"><a href="#cb14-745" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-746"><a href="#cb14-746" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error analyzing intent: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-747"><a href="#cb14-747" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"intent"</span>: <span class="st">"unknown"</span>, <span class="st">"confidence"</span>: <span class="fl">0.0</span>}</span>
<span id="cb14-748"><a href="#cb14-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-749"><a href="#cb14-749" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_entities(<span class="va">self</span>, message):</span>
<span id="cb14-750"><a href="#cb14-750" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-751"><a href="#cb14-751" aria-hidden="true" tabindex="-1"></a><span class="co">        Extract entities from a user message.</span></span>
<span id="cb14-752"><a href="#cb14-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-753"><a href="#cb14-753" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-754"><a href="#cb14-754" aria-hidden="true" tabindex="-1"></a><span class="co">            message (str): The user's message</span></span>
<span id="cb14-755"><a href="#cb14-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-756"><a href="#cb14-756" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb14-757"><a href="#cb14-757" aria-hidden="true" tabindex="-1"></a><span class="co">            dict: Extracted entities by type</span></span>
<span id="cb14-758"><a href="#cb14-758" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-759"><a href="#cb14-759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.api_key:</span>
<span id="cb14-760"><a href="#cb14-760" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span>
<span id="cb14-761"><a href="#cb14-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-762"><a href="#cb14-762" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-763"><a href="#cb14-763" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create the prompt for entity extraction</span></span>
<span id="cb14-764"><a href="#cb14-764" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb14-765"><a href="#cb14-765" aria-hidden="true" tabindex="-1"></a><span class="ss">            Extract entities from the following message.</span></span>
<span id="cb14-766"><a href="#cb14-766" aria-hidden="true" tabindex="-1"></a><span class="ss">            Return ONLY a JSON object where keys are entity types and values are the extracted entities.</span></span>
<span id="cb14-767"><a href="#cb14-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-768"><a href="#cb14-768" aria-hidden="true" tabindex="-1"></a><span class="ss">            Possible entity types: person, location, organization, date_time, product, quantity, other</span></span>
<span id="cb14-769"><a href="#cb14-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-770"><a href="#cb14-770" aria-hidden="true" tabindex="-1"></a><span class="ss">            Message: "</span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-771"><a href="#cb14-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-772"><a href="#cb14-772" aria-hidden="true" tabindex="-1"></a><span class="ss">            JSON:</span></span>
<span id="cb14-773"><a href="#cb14-773" aria-hidden="true" tabindex="-1"></a><span class="ss">            """</span></span>
<span id="cb14-774"><a href="#cb14-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-775"><a href="#cb14-775" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Call the API</span></span>
<span id="cb14-776"><a href="#cb14-776" aria-hidden="true" tabindex="-1"></a>            openai.api_key <span class="op">=</span> <span class="va">self</span>.api_key</span>
<span id="cb14-777"><a href="#cb14-777" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb14-778"><a href="#cb14-778" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-779"><a href="#cb14-779" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-780"><a href="#cb14-780" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb14-781"><a href="#cb14-781" aria-hidden="true" tabindex="-1"></a>                temperature<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb14-782"><a href="#cb14-782" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-783"><a href="#cb14-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-784"><a href="#cb14-784" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Parse the response as JSON</span></span>
<span id="cb14-785"><a href="#cb14-785" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> json</span>
<span id="cb14-786"><a href="#cb14-786" aria-hidden="true" tabindex="-1"></a>            result_text <span class="op">=</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb14-787"><a href="#cb14-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-788"><a href="#cb14-788" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle potential formatting in the response</span></span>
<span id="cb14-789"><a href="#cb14-789" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb14-790"><a href="#cb14-790" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Try to parse the raw response</span></span>
<span id="cb14-791"><a href="#cb14-791" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> json.loads(result_text)</span>
<span id="cb14-792"><a href="#cb14-792" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb14-793"><a href="#cb14-793" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If that fails, try to extract JSON from the text</span></span>
<span id="cb14-794"><a href="#cb14-794" aria-hidden="true" tabindex="-1"></a>                <span class="im">import</span> re</span>
<span id="cb14-795"><a href="#cb14-795" aria-hidden="true" tabindex="-1"></a>                json_match <span class="op">=</span> re.search(<span class="vs">r'\{.*\}'</span>, result_text, re.DOTALL)</span>
<span id="cb14-796"><a href="#cb14-796" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> json_match:</span>
<span id="cb14-797"><a href="#cb14-797" aria-hidden="true" tabindex="-1"></a>                    result <span class="op">=</span> json.loads(json_match.group(<span class="dv">0</span>))</span>
<span id="cb14-798"><a href="#cb14-798" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-799"><a href="#cb14-799" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Could not parse JSON from response"</span>)</span>
<span id="cb14-800"><a href="#cb14-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-801"><a href="#cb14-801" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb14-802"><a href="#cb14-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-803"><a href="#cb14-803" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-804"><a href="#cb14-804" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error extracting entities: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-805"><a href="#cb14-805" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span>
<span id="cb14-806"><a href="#cb14-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-807"><a href="#cb14-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-808"><a href="#cb14-808" aria-hidden="true" tabindex="-1"></a><span class="fu">### AI-Enhanced Chatbot Implementation</span></span>
<span id="cb14-809"><a href="#cb14-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-810"><a href="#cb14-810" aria-hidden="true" tabindex="-1"></a>Now, let's integrate this into our chatbot:</span>
<span id="cb14-811"><a href="#cb14-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-812"><a href="#cb14-812" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-813"><a href="#cb14-813" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIEnhancedChatbot:</span>
<span id="cb14-814"><a href="#cb14-814" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A chatbot enhanced with AI capabilities."""</span></span>
<span id="cb14-815"><a href="#cb14-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-816"><a href="#cb14-816" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">"AI Chatbot"</span>, api_key<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-817"><a href="#cb14-817" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-818"><a href="#cb14-818" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the AI-enhanced chatbot.</span></span>
<span id="cb14-819"><a href="#cb14-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-820"><a href="#cb14-820" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-821"><a href="#cb14-821" aria-hidden="true" tabindex="-1"></a><span class="co">            name (str): The chatbot's name</span></span>
<span id="cb14-822"><a href="#cb14-822" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str, optional): API key for AI services</span></span>
<span id="cb14-823"><a href="#cb14-823" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-824"><a href="#cb14-824" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb14-825"><a href="#cb14-825" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-826"><a href="#cb14-826" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversation_history <span class="op">=</span> []</span>
<span id="cb14-827"><a href="#cb14-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-828"><a href="#cb14-828" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize AI components</span></span>
<span id="cb14-829"><a href="#cb14-829" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.message_understanding <span class="op">=</span> MessageUnderstanding(api_key)</span>
<span id="cb14-830"><a href="#cb14-830" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversational_ai <span class="op">=</span> ConversationalAI(</span>
<span id="cb14-831"><a href="#cb14-831" aria-hidden="true" tabindex="-1"></a>            api_key<span class="op">=</span>api_key,</span>
<span id="cb14-832"><a href="#cb14-832" aria-hidden="true" tabindex="-1"></a>            system_prompt<span class="op">=</span><span class="ss">f"You are </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">, a helpful assistant. Keep responses concise and friendly."</span></span>
<span id="cb14-833"><a href="#cb14-833" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-834"><a href="#cb14-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-835"><a href="#cb14-835" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flag to control AI usage</span></span>
<span id="cb14-836"><a href="#cb14-836" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.use_ai <span class="op">=</span> <span class="va">True</span></span>
<span id="cb14-837"><a href="#cb14-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-838"><a href="#cb14-838" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> greet(<span class="va">self</span>):</span>
<span id="cb14-839"><a href="#cb14-839" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Greet the user and get their name."""</span></span>
<span id="cb14-840"><a href="#cb14-840" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Hello! I'm </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">, an AI-enhanced chatbot. Type 'bye' to exit."</span>)</span>
<span id="cb14-841"><a href="#cb14-841" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_name <span class="op">=</span> <span class="bu">input</span>(<span class="st">"What's your name? "</span>)</span>
<span id="cb14-842"><a href="#cb14-842" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Nice to meet you, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">!"</span>)</span>
<span id="cb14-843"><a href="#cb14-843" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_to_history(<span class="st">"SYSTEM"</span>, <span class="ss">f"Conversation started with </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-844"><a href="#cb14-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-845"><a href="#cb14-845" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_to_history(<span class="va">self</span>, speaker, text):</span>
<span id="cb14-846"><a href="#cb14-846" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add a message to the conversation history."""</span></span>
<span id="cb14-847"><a href="#cb14-847" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb14-848"><a href="#cb14-848" aria-hidden="true" tabindex="-1"></a>        timestamp <span class="op">=</span> datetime.now().strftime(<span class="st">"%H:%M:%S"</span>)</span>
<span id="cb14-849"><a href="#cb14-849" aria-hidden="true" tabindex="-1"></a>        entry <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span>timestamp<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>speaker<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-850"><a href="#cb14-850" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conversation_history.append(entry)</span>
<span id="cb14-851"><a href="#cb14-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-852"><a href="#cb14-852" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_response(<span class="va">self</span>, user_input):</span>
<span id="cb14-853"><a href="#cb14-853" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate a response to the user input using AI capabilities."""</span></span>
<span id="cb14-854"><a href="#cb14-854" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle special commands</span></span>
<span id="cb14-855"><a href="#cb14-855" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> user_input.lower() <span class="op">==</span> <span class="st">"help"</span>:</span>
<span id="cb14-856"><a href="#cb14-856" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_help()</span>
<span id="cb14-857"><a href="#cb14-857" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> user_input.lower() <span class="op">==</span> <span class="st">"history"</span>:</span>
<span id="cb14-858"><a href="#cb14-858" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.show_history()</span>
<span id="cb14-859"><a href="#cb14-859" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> user_input.lower() <span class="op">==</span> <span class="st">"toggle ai"</span>:</span>
<span id="cb14-860"><a href="#cb14-860" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.use_ai <span class="op">=</span> <span class="kw">not</span> <span class="va">self</span>.use_ai</span>
<span id="cb14-861"><a href="#cb14-861" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"AI features turned </span><span class="sc">{</span><span class="st">'on'</span> <span class="cf">if</span> <span class="va">self</span><span class="sc">.</span>use_ai <span class="cf">else</span> <span class="st">'off'</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-862"><a href="#cb14-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-863"><a href="#cb14-863" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.use_ai:</span>
<span id="cb14-864"><a href="#cb14-864" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fall back to rule-based response if AI is disabled</span></span>
<span id="cb14-865"><a href="#cb14-865" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_rule_based_response(user_input)</span>
<span id="cb14-866"><a href="#cb14-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-867"><a href="#cb14-867" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-868"><a href="#cb14-868" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use AI to understand the message</span></span>
<span id="cb14-869"><a href="#cb14-869" aria-hidden="true" tabindex="-1"></a>            intent_analysis <span class="op">=</span> <span class="va">self</span>.message_understanding.analyze_intent(user_input)</span>
<span id="cb14-870"><a href="#cb14-870" aria-hidden="true" tabindex="-1"></a>            entities <span class="op">=</span> <span class="va">self</span>.message_understanding.extract_entities(user_input)</span>
<span id="cb14-871"><a href="#cb14-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-872"><a href="#cb14-872" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log the understanding (in a real system, you might not show this to the user)</span></span>
<span id="cb14-873"><a href="#cb14-873" aria-hidden="true" tabindex="-1"></a>            understanding_log <span class="op">=</span> <span class="ss">f"Intent: </span><span class="sc">{</span>intent_analysis<span class="sc">.</span>get(<span class="st">'intent'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>intent_analysis<span class="sc">.</span>get(<span class="st">'confidence'</span>, <span class="dv">0</span>)<span class="sc">:.2f}</span><span class="ss">)"</span></span>
<span id="cb14-874"><a href="#cb14-874" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> entities:</span>
<span id="cb14-875"><a href="#cb14-875" aria-hidden="true" tabindex="-1"></a>                understanding_log <span class="op">+=</span> <span class="ss">f", Entities: </span><span class="sc">{</span>entities<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb14-876"><a href="#cb14-876" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="st">"SYSTEM"</span>, understanding_log)</span>
<span id="cb14-877"><a href="#cb14-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-878"><a href="#cb14-878" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get a response from the conversational AI</span></span>
<span id="cb14-879"><a href="#cb14-879" aria-hidden="true" tabindex="-1"></a>            ai_response <span class="op">=</span> <span class="va">self</span>.conversational_ai.get_response(user_input)</span>
<span id="cb14-880"><a href="#cb14-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-881"><a href="#cb14-881" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ai_response</span>
<span id="cb14-882"><a href="#cb14-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-883"><a href="#cb14-883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-884"><a href="#cb14-884" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error in AI processing: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-885"><a href="#cb14-885" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fall back to rule-based response if AI fails</span></span>
<span id="cb14-886"><a href="#cb14-886" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.get_rule_based_response(user_input)</span>
<span id="cb14-887"><a href="#cb14-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-888"><a href="#cb14-888" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_rule_based_response(<span class="va">self</span>, user_input):</span>
<span id="cb14-889"><a href="#cb14-889" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate a response using simple rule-based patterns."""</span></span>
<span id="cb14-890"><a href="#cb14-890" aria-hidden="true" tabindex="-1"></a>        user_input <span class="op">=</span> user_input.lower()</span>
<span id="cb14-891"><a href="#cb14-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-892"><a href="#cb14-892" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"hello"</span> <span class="kw">in</span> user_input <span class="kw">or</span> <span class="st">"hi"</span> <span class="kw">in</span> user_input:</span>
<span id="cb14-893"><a href="#cb14-893" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Hello, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! How can I help you today?"</span></span>
<span id="cb14-894"><a href="#cb14-894" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"how are you"</span> <span class="kw">in</span> user_input:</span>
<span id="cb14-895"><a href="#cb14-895" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm doing well, thank you for asking!"</span></span>
<span id="cb14-896"><a href="#cb14-896" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"your name"</span> <span class="kw">in</span> user_input:</span>
<span id="cb14-897"><a href="#cb14-897" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"My name is </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">. I'm an AI-enhanced chatbot."</span></span>
<span id="cb14-898"><a href="#cb14-898" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"bye"</span> <span class="kw">in</span> user_input <span class="kw">or</span> <span class="st">"goodbye"</span> <span class="kw">in</span> user_input:</span>
<span id="cb14-899"><a href="#cb14-899" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="ss">f"Goodbye, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! It was nice chatting with you."</span></span>
<span id="cb14-900"><a href="#cb14-900" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-901"><a href="#cb14-901" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm not sure how to respond to that. Can you try asking something else?"</span></span>
<span id="cb14-902"><a href="#cb14-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-903"><a href="#cb14-903" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> show_history(<span class="va">self</span>):</span>
<span id="cb14-904"><a href="#cb14-904" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Show the conversation history."""</span></span>
<span id="cb14-905"><a href="#cb14-905" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.conversation_history:</span>
<span id="cb14-906"><a href="#cb14-906" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"No conversation history yet."</span></span>
<span id="cb14-907"><a href="#cb14-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-908"><a href="#cb14-908" aria-hidden="true" tabindex="-1"></a>        history <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">----- Conversation History -----</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb14-909"><a href="#cb14-909" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> entry <span class="kw">in</span> <span class="va">self</span>.conversation_history:</span>
<span id="cb14-910"><a href="#cb14-910" aria-hidden="true" tabindex="-1"></a>            history <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>entry<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb14-911"><a href="#cb14-911" aria-hidden="true" tabindex="-1"></a>        history <span class="op">+=</span> <span class="st">"-------------------------------"</span></span>
<span id="cb14-912"><a href="#cb14-912" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> history</span>
<span id="cb14-913"><a href="#cb14-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-914"><a href="#cb14-914" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_help(<span class="va">self</span>):</span>
<span id="cb14-915"><a href="#cb14-915" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get help information."""</span></span>
<span id="cb14-916"><a href="#cb14-916" aria-hidden="true" tabindex="-1"></a>        help_text <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb14-917"><a href="#cb14-917" aria-hidden="true" tabindex="-1"></a><span class="ss">Available Commands:</span></span>
<span id="cb14-918"><a href="#cb14-918" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'help': Display this help message</span></span>
<span id="cb14-919"><a href="#cb14-919" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'history': Show conversation history</span></span>
<span id="cb14-920"><a href="#cb14-920" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'toggle ai': Turn AI features on/off</span></span>
<span id="cb14-921"><a href="#cb14-921" aria-hidden="true" tabindex="-1"></a><span class="ss">- 'bye': End the conversation</span></span>
<span id="cb14-922"><a href="#cb14-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-923"><a href="#cb14-923" aria-hidden="true" tabindex="-1"></a><span class="ss">You can also just chat with me normally, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">!</span></span>
<span id="cb14-924"><a href="#cb14-924" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb14-925"><a href="#cb14-925" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> help_text</span>
<span id="cb14-926"><a href="#cb14-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-927"><a href="#cb14-927" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb14-928"><a href="#cb14-928" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Run the main chatbot loop."""</span></span>
<span id="cb14-929"><a href="#cb14-929" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.greet()</span>
<span id="cb14-930"><a href="#cb14-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-931"><a href="#cb14-931" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb14-932"><a href="#cb14-932" aria-hidden="true" tabindex="-1"></a>            user_input <span class="op">=</span> <span class="bu">input</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">&gt; "</span>)</span>
<span id="cb14-933"><a href="#cb14-933" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="va">self</span>.user_name, user_input)</span>
<span id="cb14-934"><a href="#cb14-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-935"><a href="#cb14-935" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> user_input.lower() <span class="op">==</span> <span class="st">"bye"</span>:</span>
<span id="cb14-936"><a href="#cb14-936" aria-hidden="true" tabindex="-1"></a>                response <span class="op">=</span> <span class="ss">f"Goodbye, </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>user_name<span class="sc">}</span><span class="ss">! I hope to chat again soon."</span></span>
<span id="cb14-937"><a href="#cb14-937" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">&gt; </span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-938"><a href="#cb14-938" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.add_to_history(<span class="va">self</span>.name, response)</span>
<span id="cb14-939"><a href="#cb14-939" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb14-940"><a href="#cb14-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-941"><a href="#cb14-941" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.get_response(user_input)</span>
<span id="cb14-942"><a href="#cb14-942" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">&gt; </span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-943"><a href="#cb14-943" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.add_to_history(<span class="va">self</span>.name, response)</span>
<span id="cb14-944"><a href="#cb14-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-945"><a href="#cb14-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-946"><a href="#cb14-946" aria-hidden="true" tabindex="-1"></a><span class="fu">### Running the AI-Enhanced Chatbot</span></span>
<span id="cb14-947"><a href="#cb14-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-948"><a href="#cb14-948" aria-hidden="true" tabindex="-1"></a>Here's how you might run the AI-enhanced chatbot:</span>
<span id="cb14-949"><a href="#cb14-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-950"><a href="#cb14-950" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-951"><a href="#cb14-951" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb14-952"><a href="#cb14-952" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Import necessary modules</span></span>
<span id="cb14-953"><a href="#cb14-953" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb14-954"><a href="#cb14-954" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb14-955"><a href="#cb14-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-956"><a href="#cb14-956" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load environment variables</span></span>
<span id="cb14-957"><a href="#cb14-957" aria-hidden="true" tabindex="-1"></a>    load_dotenv()</span>
<span id="cb14-958"><a href="#cb14-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-959"><a href="#cb14-959" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get API key from environment</span></span>
<span id="cb14-960"><a href="#cb14-960" aria-hidden="true" tabindex="-1"></a>    api_key <span class="op">=</span> os.environ.get(<span class="st">"OPENAI_API_KEY"</span>)</span>
<span id="cb14-961"><a href="#cb14-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-962"><a href="#cb14-962" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if API key is available</span></span>
<span id="cb14-963"><a href="#cb14-963" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> api_key:</span>
<span id="cb14-964"><a href="#cb14-964" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Warning: No OpenAI API key found in environment variables."</span>)</span>
<span id="cb14-965"><a href="#cb14-965" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The chatbot will run with limited AI capabilities."</span>)</span>
<span id="cb14-966"><a href="#cb14-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-967"><a href="#cb14-967" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ask if user wants to proceed</span></span>
<span id="cb14-968"><a href="#cb14-968" aria-hidden="true" tabindex="-1"></a>        proceed <span class="op">=</span> <span class="bu">input</span>(<span class="st">"Do you want to continue without AI features? (y/n): "</span>)</span>
<span id="cb14-969"><a href="#cb14-969" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> proceed.lower() <span class="op">!=</span> <span class="st">"y"</span>:</span>
<span id="cb14-970"><a href="#cb14-970" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Exiting. Please set up an API key in a .env file to use AI features."</span>)</span>
<span id="cb14-971"><a href="#cb14-971" aria-hidden="true" tabindex="-1"></a>            exit()</span>
<span id="cb14-972"><a href="#cb14-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-973"><a href="#cb14-973" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and run the chatbot</span></span>
<span id="cb14-974"><a href="#cb14-974" aria-hidden="true" tabindex="-1"></a>    chatbot <span class="op">=</span> AIEnhancedChatbot(name<span class="op">=</span><span class="st">"AIBot"</span>, api_key<span class="op">=</span>api_key)</span>
<span id="cb14-975"><a href="#cb14-975" aria-hidden="true" tabindex="-1"></a>    chatbot.run()</span>
<span id="cb14-976"><a href="#cb14-976" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-977"><a href="#cb14-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-978"><a href="#cb14-978" aria-hidden="true" tabindex="-1"></a><span class="fu">## 10. Handling API Costs and Rate Limits</span></span>
<span id="cb14-979"><a href="#cb14-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-980"><a href="#cb14-980" aria-hidden="true" tabindex="-1"></a>When using AI services in your chatbot, it's important to be mindful of costs and rate limits:</span>
<span id="cb14-981"><a href="#cb14-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-982"><a href="#cb14-982" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Track usage**: Implement a counter for API calls and log costs</span>
<span id="cb14-983"><a href="#cb14-983" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Set limits**: Define maximum daily/monthly usage thresholds</span>
<span id="cb14-984"><a href="#cb14-984" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Cache responses**: Store responses for common queries</span>
<span id="cb14-985"><a href="#cb14-985" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Use fallbacks**: Implement rule-based responses as fallbacks</span>
<span id="cb14-986"><a href="#cb14-986" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Tier your approach**: Use cheaper AI services for routine tasks, reserve expensive ones for complex queries</span>
<span id="cb14-987"><a href="#cb14-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-988"><a href="#cb14-988" aria-hidden="true" tabindex="-1"></a>Here's an example of a cost-tracking wrapper:</span>
<span id="cb14-989"><a href="#cb14-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-990"><a href="#cb14-990" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb14-991"><a href="#cb14-991" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CostTrackingAI:</span>
<span id="cb14-992"><a href="#cb14-992" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""A wrapper for AI services that tracks usage and costs."""</span></span>
<span id="cb14-993"><a href="#cb14-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-994"><a href="#cb14-994" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, api_key, cost_per_1k_tokens<span class="op">=</span><span class="fl">0.002</span>, daily_budget<span class="op">=</span><span class="fl">1.0</span>):</span>
<span id="cb14-995"><a href="#cb14-995" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-996"><a href="#cb14-996" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the cost tracking AI wrapper.</span></span>
<span id="cb14-997"><a href="#cb14-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-998"><a href="#cb14-998" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-999"><a href="#cb14-999" aria-hidden="true" tabindex="-1"></a><span class="co">            api_key (str): API key for the service</span></span>
<span id="cb14-1000"><a href="#cb14-1000" aria-hidden="true" tabindex="-1"></a><span class="co">            cost_per_1k_tokens (float): Cost per 1000 tokens in USD</span></span>
<span id="cb14-1001"><a href="#cb14-1001" aria-hidden="true" tabindex="-1"></a><span class="co">            daily_budget (float): Maximum daily budget in USD</span></span>
<span id="cb14-1002"><a href="#cb14-1002" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-1003"><a href="#cb14-1003" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.api_key <span class="op">=</span> api_key</span>
<span id="cb14-1004"><a href="#cb14-1004" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost_per_1k_tokens <span class="op">=</span> cost_per_1k_tokens</span>
<span id="cb14-1005"><a href="#cb14-1005" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.daily_budget <span class="op">=</span> daily_budget</span>
<span id="cb14-1006"><a href="#cb14-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1007"><a href="#cb14-1007" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize usage tracking</span></span>
<span id="cb14-1008"><a href="#cb14-1008" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokens_used_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1009"><a href="#cb14-1009" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.requests_made_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1010"><a href="#cb14-1010" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.estimated_cost_today <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-1011"><a href="#cb14-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1012"><a href="#cb14-1012" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the OpenAI client</span></span>
<span id="cb14-1013"><a href="#cb14-1013" aria-hidden="true" tabindex="-1"></a>        openai.api_key <span class="op">=</span> api_key</span>
<span id="cb14-1014"><a href="#cb14-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1015"><a href="#cb14-1015" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the date for tracking</span></span>
<span id="cb14-1016"><a href="#cb14-1016" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb14-1017"><a href="#cb14-1017" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_date <span class="op">=</span> date.today()</span>
<span id="cb14-1018"><a href="#cb14-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1019"><a href="#cb14-1019" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update_date(<span class="va">self</span>):</span>
<span id="cb14-1020"><a href="#cb14-1020" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Update the current date and reset counters if needed."""</span></span>
<span id="cb14-1021"><a href="#cb14-1021" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb14-1022"><a href="#cb14-1022" aria-hidden="true" tabindex="-1"></a>        today <span class="op">=</span> date.today()</span>
<span id="cb14-1023"><a href="#cb14-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1024"><a href="#cb14-1024" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> today <span class="op">&gt;</span> <span class="va">self</span>.current_date:</span>
<span id="cb14-1025"><a href="#cb14-1025" aria-hidden="true" tabindex="-1"></a>            <span class="co"># It's a new day, reset counters</span></span>
<span id="cb14-1026"><a href="#cb14-1026" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.current_date <span class="op">=</span> today</span>
<span id="cb14-1027"><a href="#cb14-1027" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tokens_used_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1028"><a href="#cb14-1028" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.requests_made_today <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-1029"><a href="#cb14-1029" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.estimated_cost_today <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-1030"><a href="#cb14-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1031"><a href="#cb14-1031" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update_usage(<span class="va">self</span>, tokens_used):</span>
<span id="cb14-1032"><a href="#cb14-1032" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-1033"><a href="#cb14-1033" aria-hidden="true" tabindex="-1"></a><span class="co">        Update usage statistics.</span></span>
<span id="cb14-1034"><a href="#cb14-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1035"><a href="#cb14-1035" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-1036"><a href="#cb14-1036" aria-hidden="true" tabindex="-1"></a><span class="co">            tokens_used (int): Number of tokens used in the request</span></span>
<span id="cb14-1037"><a href="#cb14-1037" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-1038"><a href="#cb14-1038" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._update_date()</span>
<span id="cb14-1039"><a href="#cb14-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1040"><a href="#cb14-1040" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokens_used_today <span class="op">+=</span> tokens_used</span>
<span id="cb14-1041"><a href="#cb14-1041" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.requests_made_today <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-1042"><a href="#cb14-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1043"><a href="#cb14-1043" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate cost</span></span>
<span id="cb14-1044"><a href="#cb14-1044" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> (tokens_used <span class="op">/</span> <span class="dv">1000</span>) <span class="op">*</span> <span class="va">self</span>.cost_per_1k_tokens</span>
<span id="cb14-1045"><a href="#cb14-1045" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.estimated_cost_today <span class="op">+=</span> cost</span>
<span id="cb14-1046"><a href="#cb14-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1047"><a href="#cb14-1047" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> can_make_request(<span class="va">self</span>, estimated_tokens<span class="op">=</span><span class="dv">500</span>):</span>
<span id="cb14-1048"><a href="#cb14-1048" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-1049"><a href="#cb14-1049" aria-hidden="true" tabindex="-1"></a><span class="co">        Check if a request can be made within budget constraints.</span></span>
<span id="cb14-1050"><a href="#cb14-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1051"><a href="#cb14-1051" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-1052"><a href="#cb14-1052" aria-hidden="true" tabindex="-1"></a><span class="co">            estimated_tokens (int): Estimated tokens for the request</span></span>
<span id="cb14-1053"><a href="#cb14-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1054"><a href="#cb14-1054" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb14-1055"><a href="#cb14-1055" aria-hidden="true" tabindex="-1"></a><span class="co">            bool: True if the request can be made, False otherwise</span></span>
<span id="cb14-1056"><a href="#cb14-1056" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-1057"><a href="#cb14-1057" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._update_date()</span>
<span id="cb14-1058"><a href="#cb14-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1059"><a href="#cb14-1059" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate cost of this request</span></span>
<span id="cb14-1060"><a href="#cb14-1060" aria-hidden="true" tabindex="-1"></a>        estimated_cost <span class="op">=</span> (estimated_tokens <span class="op">/</span> <span class="dv">1000</span>) <span class="op">*</span> <span class="va">self</span>.cost_per_1k_tokens</span>
<span id="cb14-1061"><a href="#cb14-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1062"><a href="#cb14-1062" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if it would exceed the budget</span></span>
<span id="cb14-1063"><a href="#cb14-1063" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.estimated_cost_today <span class="op">+</span> estimated_cost) <span class="op">&lt;=</span> <span class="va">self</span>.daily_budget</span>
<span id="cb14-1064"><a href="#cb14-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1065"><a href="#cb14-1065" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_completion(<span class="va">self</span>, prompt, max_tokens<span class="op">=</span><span class="dv">150</span>):</span>
<span id="cb14-1066"><a href="#cb14-1066" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb14-1067"><a href="#cb14-1067" aria-hidden="true" tabindex="-1"></a><span class="co">        Get a completion from the AI while tracking costs.</span></span>
<span id="cb14-1068"><a href="#cb14-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1069"><a href="#cb14-1069" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb14-1070"><a href="#cb14-1070" aria-hidden="true" tabindex="-1"></a><span class="co">            prompt (str): The prompt to send</span></span>
<span id="cb14-1071"><a href="#cb14-1071" aria-hidden="true" tabindex="-1"></a><span class="co">            max_tokens (int): Maximum tokens in the response</span></span>
<span id="cb14-1072"><a href="#cb14-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1073"><a href="#cb14-1073" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb14-1074"><a href="#cb14-1074" aria-hidden="true" tabindex="-1"></a><span class="co">            str: The AI's response</span></span>
<span id="cb14-1075"><a href="#cb14-1075" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb14-1076"><a href="#cb14-1076" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if we can make the request</span></span>
<span id="cb14-1077"><a href="#cb14-1077" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.can_make_request(estimated_tokens<span class="op">=</span><span class="bu">len</span>(prompt.split()) <span class="op">+</span> max_tokens):</span>
<span id="cb14-1078"><a href="#cb14-1078" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"I'm sorry, I've reached my usage limit for today. Please try again tomorrow."</span></span>
<span id="cb14-1079"><a href="#cb14-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1080"><a href="#cb14-1080" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-1081"><a href="#cb14-1081" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make the API call</span></span>
<span id="cb14-1082"><a href="#cb14-1082" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb14-1083"><a href="#cb14-1083" aria-hidden="true" tabindex="-1"></a>                model<span class="op">=</span><span class="st">"gpt-3.5-turbo"</span>,</span>
<span id="cb14-1084"><a href="#cb14-1084" aria-hidden="true" tabindex="-1"></a>                messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb14-1085"><a href="#cb14-1085" aria-hidden="true" tabindex="-1"></a>                max_tokens<span class="op">=</span>max_tokens</span>
<span id="cb14-1086"><a href="#cb14-1086" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-1087"><a href="#cb14-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1088"><a href="#cb14-1088" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Update usage tracking</span></span>
<span id="cb14-1089"><a href="#cb14-1089" aria-hidden="true" tabindex="-1"></a>            prompt_tokens <span class="op">=</span> response.usage.prompt_tokens</span>
<span id="cb14-1090"><a href="#cb14-1090" aria-hidden="true" tabindex="-1"></a>            completion_tokens <span class="op">=</span> response.usage.completion_tokens</span>
<span id="cb14-1091"><a href="#cb14-1091" aria-hidden="true" tabindex="-1"></a>            total_tokens <span class="op">=</span> response.usage.total_tokens</span>
<span id="cb14-1092"><a href="#cb14-1092" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update_usage(total_tokens)</span>
<span id="cb14-1093"><a href="#cb14-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1094"><a href="#cb14-1094" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log usage</span></span>
<span id="cb14-1095"><a href="#cb14-1095" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Request used </span><span class="sc">{</span>total_tokens<span class="sc">}</span><span class="ss"> tokens ($</span><span class="sc">{</span>(total_tokens<span class="op">/</span><span class="dv">1000</span>)<span class="op">*</span><span class="va">self</span><span class="sc">.</span>cost_per_1k_tokens<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb14-1096"><a href="#cb14-1096" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Daily usage: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>tokens_used_today<span class="sc">}</span><span class="ss"> tokens, Est. cost: $</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>estimated_cost_today<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-1097"><a href="#cb14-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1098"><a href="#cb14-1098" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content.strip()</span>
<span id="cb14-1099"><a href="#cb14-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1100"><a href="#cb14-1100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-1101"><a href="#cb14-1101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error in AI request: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-1102"><a href="#cb14-1102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Sorry, I encountered an error processing your request."</span></span>
<span id="cb14-1103"><a href="#cb14-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1104"><a href="#cb14-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1105"><a href="#cb14-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cross-References</span></span>
<span id="cb14-1106"><a href="#cb14-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1107"><a href="#cb14-1107" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Previous Chapter: <span class="co">[</span><span class="ot">AI Programming Assistants</span><span class="co">](AI_Programming_Assistants.qmd)</span></span>
<span id="cb14-1108"><a href="#cb14-1108" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Next Chapter: <span class="co">[</span><span class="ot">AI Assistance Tips</span><span class="co">](AI_Assistance_Tips.qmd)</span></span>
<span id="cb14-1109"><a href="#cb14-1109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Related Topics: Object-Oriented Programming (Chapter 20), Modules and Packages (Chapter 19)</span>
<span id="cb14-1110"><a href="#cb14-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1111"><a href="#cb14-1111" aria-hidden="true" tabindex="-1"></a>***AI Tip: When integrating AI APIs with Python, follow the "graceful degradation" pattern - design your system to work in a reduced capacity when AI services are unavailable or when rate limits are reached. This ensures your application remains functional even when AI services are temporarily inaccessible.***</span>
<span id="cb14-1112"><a href="#cb14-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1113"><a href="#cb14-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb14-1114"><a href="#cb14-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1115"><a href="#cb14-1115" aria-hidden="true" tabindex="-1"></a>In this chapter, we've explored how to integrate AI capabilities into Python applications:</span>
<span id="cb14-1116"><a href="#cb14-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1117"><a href="#cb14-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>We began by understanding the landscape of AI services available for Python integration, from LLMs to vision and speech processing.</span>
<span id="cb14-1118"><a href="#cb14-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1119"><a href="#cb14-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>We learned how to make direct API calls to AI services using Python's requests library, and how to use specialized SDKs for more convenient integration.</span>
<span id="cb14-1120"><a href="#cb14-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1121"><a href="#cb14-1121" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>We implemented various text processing capabilities, including sentiment analysis, named entity recognition, and text summarization.</span>
<span id="cb14-1122"><a href="#cb14-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1123"><a href="#cb14-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>We built conversational AI features, both stateless and with conversation memory, to enable more natural interactions.</span>
<span id="cb14-1124"><a href="#cb14-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1125"><a href="#cb14-1125" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>We covered important practical considerations, including API authentication, testing strategies, and cost management.</span>
<span id="cb14-1126"><a href="#cb14-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1127"><a href="#cb14-1127" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Finally, we applied these techniques to enhance our chatbot project with AI capabilities, making it more intelligent and helpful.</span>
<span id="cb14-1128"><a href="#cb14-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1129"><a href="#cb14-1129" aria-hidden="true" tabindex="-1"></a>As AI services continue to evolve and become more accessible, the ability to integrate them into Python applications will be an increasingly valuable skill. By understanding the patterns and practices covered in this chapter, you're well-equipped to build applications that leverage the power of AI, even without deep expertise in machine learning or data science.</span>
<span id="cb14-1130"><a href="#cb14-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1131"><a href="#cb14-1131" aria-hidden="true" tabindex="-1"></a>Remember that integrating external AI services involves trade-offs in terms of cost, privacy, and dependence on third-party systems. Always consider these factors when deciding whether and how to incorporate AI into your Python projects.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>